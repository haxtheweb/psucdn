System.register(["./734b9790.js","./f797ef41.js","./c30cb795.js","./67ae3bfe.js","./284598da.js"],(function(e,t){"use strict";var s,a,n,i,o,r,l,d,h,u,c,p,m,b,g,v,y,f,w,j,x,E;return{setters:[function(e){s=e.aQ,a=e.aR,n=e.v,i=e._,o=e.a,r=e.x,l=e.b,d=e.N,h=e.$,u=e.f,c=e.g,p=e.s,m=e.c,b=e.d,g=e.o,v=e.t,y=e.j,f=e.k,w=e.M,j=e.u,x=e.l},function(){},function(){},function(e){E=e.H},function(){}],execute:function(){var S;s({is:"iron-request",hostAttributes:{hidden:!0},properties:{xhr:{type:Object,notify:!0,readOnly:!0,value:function(){return new XMLHttpRequest}},response:{type:Object,notify:!0,readOnly:!0,value:function(){return null}},status:{type:Number,notify:!0,readOnly:!0,value:0},statusText:{type:String,notify:!0,readOnly:!0,value:""},completes:{type:Object,readOnly:!0,notify:!0,value:function(){return new Promise(function(e,t){this.resolveCompletes=e,this.rejectCompletes=t}.bind(this))}},progress:{type:Object,notify:!0,readOnly:!0,value:function(){return{}}},aborted:{type:Boolean,notify:!0,readOnly:!0,value:!1},errored:{type:Boolean,notify:!0,readOnly:!0,value:!1},timedOut:{type:Boolean,notify:!0,readOnly:!0,value:!1}},get succeeded(){if(this.errored||this.aborted||this.timedOut)return!1;var e=this.xhr.status||0;return 0===e||e>=200&&e<300},send:function(e){var t=this.xhr;if(t.readyState>0)return null;t.addEventListener("progress",function(e){this._setProgress({lengthComputable:e.lengthComputable,loaded:e.loaded,total:e.total}),this.fire("iron-request-progress-changed",{value:this.progress})}.bind(this)),t.addEventListener("error",function(t){this._setErrored(!0),this._updateStatus();var s=e.rejectWithRequest?{error:t,request:this}:t;this.rejectCompletes(s)}.bind(this)),t.addEventListener("timeout",function(t){this._setTimedOut(!0),this._updateStatus();var s=e.rejectWithRequest?{error:t,request:this}:t;this.rejectCompletes(s)}.bind(this)),t.addEventListener("abort",function(){this._setAborted(!0),this._updateStatus();var t=new Error("Request aborted."),s=e.rejectWithRequest?{error:t,request:this}:t;this.rejectCompletes(s)}.bind(this)),t.addEventListener("loadend",function(){if(this._updateStatus(),this._setResponse(this.parseResponse()),this.succeeded)this.resolveCompletes(this);else{var t=new Error("The request failed with status code: "+this.xhr.status),s=e.rejectWithRequest?{error:t,request:this}:t;this.rejectCompletes(s)}}.bind(this)),this.url=e.url;var s=!1!==e.async;t.open(e.method||"GET",e.url,s);var n={json:"application/json",text:"text/plain",html:"text/html",xml:"application/xml",arraybuffer:"application/octet-stream"}[e.handleAs],i=e.headers||Object.create(null),o=Object.create(null);for(var r in i)o[r.toLowerCase()]=i[r];if(i=o,n&&!i.accept&&(i.accept=n),Object.keys(i).forEach((function(e){/[A-Z]/.test(e)&&a._error("Headers must be lower case, got",e),t.setRequestHeader(e,i[e])}),this),s){t.timeout=e.timeout;var l=e.handleAs;!e.jsonPrefix&&l||(l="text"),t.responseType=t._responseType=l,e.jsonPrefix&&(t._jsonPrefix=e.jsonPrefix)}t.withCredentials=!!e.withCredentials;var d=this._encodeBodyObject(e.body,i["content-type"]);return t.send(d),this.completes},parseResponse:function(){var e=this.xhr,t=e.responseType||e._responseType,s=!this.xhr.responseType,a=e._jsonPrefix&&e._jsonPrefix.length||0;try{switch(t){case"json":if(s||void 0===e.response)try{return JSON.parse(e.responseText)}catch(t){return console.warn("Failed to parse JSON sent from "+e.responseURL),null}return e.response;case"xml":return e.responseXML;case"blob":case"document":case"arraybuffer":return e.response;default:if(a)try{return JSON.parse(e.responseText.substring(a))}catch(t){return console.warn("Failed to parse JSON sent from "+e.responseURL),null}return e.responseText}}catch(e){this.rejectCompletes(new Error("Could not parse response. "+e.message))}},abort:function(){this._setAborted(!0),this.xhr.abort()},_encodeBodyObject:function(e,t){if("string"==typeof e)return e;var s=e;switch(t){case"application/json":return JSON.stringify(s);case"application/x-www-form-urlencoded":return this._wwwFormUrlEncode(s)}return e},_wwwFormUrlEncode:function(e){if(!e)return"";var t=[];return Object.keys(e).forEach((function(s){t.push(this._wwwFormUrlEncodePiece(s)+"="+this._wwwFormUrlEncodePiece(e[s]))}),this),t.join("&")},_wwwFormUrlEncodePiece:function(e){return null!=e&&e.toString?encodeURIComponent(e.toString().replace(/\r?\n/g,"\r\n")).replace(/%20/g,"+"):""},_updateStatus:function(){this._setStatus(this.xhr.status),this._setStatusText(void 0===this.xhr.statusText?"":this.xhr.statusText)}}),s({is:"iron-ajax",hostAttributes:{hidden:!0},properties:{url:{type:String},params:{type:Object,value:function(){return{}}},method:{type:String,value:"GET"},headers:{type:Object,value:function(){return{}}},contentType:{type:String,value:null},body:{type:Object,value:null},sync:{type:Boolean,value:!1},handleAs:{type:String,value:"json"},withCredentials:{type:Boolean,value:!1},timeout:{type:Number,value:0},auto:{type:Boolean,value:!1},verbose:{type:Boolean,value:!1},lastRequest:{type:Object,notify:!0,readOnly:!0},lastProgress:{type:Object,notify:!0,readOnly:!0},loading:{type:Boolean,notify:!0,readOnly:!0},lastResponse:{type:Object,notify:!0,readOnly:!0},lastError:{type:Object,notify:!0,readOnly:!0},activeRequests:{type:Array,notify:!0,readOnly:!0,value:function(){return[]}},debounceDuration:{type:Number,value:0,notify:!0},jsonPrefix:{type:String,value:""},bubbles:{type:Boolean,value:!1},rejectWithRequest:{type:Boolean,value:!1},_boundHandleResponse:{type:Function,value:function(){return this._handleResponse.bind(this)}}},observers:["_requestOptionsChanged(url, method, params.*, headers, contentType, body, sync, handleAs, jsonPrefix, withCredentials, timeout, auto)"],created:function(){this._boundOnProgressChanged=this._onProgressChanged.bind(this)},get queryString(){var e,t,s=[];for(e in this.params)if(t=this.params[e],e=window.encodeURIComponent(e),Array.isArray(t))for(var a=0;a<t.length;a++)s.push(e+"="+window.encodeURIComponent(t[a]));else null!==t?s.push(e+"="+window.encodeURIComponent(t)):s.push(e);return s.join("&")},get requestUrl(){var e=this.queryString,t=this.url||"";if(e){var s=t.indexOf("?")>=0?"&":"?";return t+s+e}return t},get requestHeaders(){var e,t={},s=this.contentType;if(null==s&&"string"==typeof this.body&&(s="application/x-www-form-urlencoded"),s&&(t["content-type"]=s),"object"===n(this.headers))for(e in this.headers)t[e]=this.headers[e].toString();return t},_onProgressChanged:function(e){this._setLastProgress(e.detail.value)},toRequestOptions:function(){return{url:this.requestUrl||"",method:this.method,headers:this.requestHeaders,body:this.body,async:!this.sync,handleAs:this.handleAs,jsonPrefix:this.jsonPrefix,withCredentials:this.withCredentials,timeout:this.timeout,rejectWithRequest:this.rejectWithRequest}},generateRequest:function(){var e=document.createElement("iron-request"),t=this.toRequestOptions();return this.push("activeRequests",e),e.completes.then(this._boundHandleResponse).catch(this._handleError.bind(this,e)).then(this._discardRequest.bind(this,e)),this.fire("iron-ajax-presend",{request:e,options:t},{bubbles:this.bubbles,cancelable:!0}).defaultPrevented?(e.abort(),e.rejectCompletes(e),e):(this.lastRequest&&this.lastRequest.removeEventListener("iron-request-progress-changed",this._boundOnProgressChanged),e.addEventListener("iron-request-progress-changed",this._boundOnProgressChanged),e.send(t),this._setLastProgress(null),this._setLastRequest(e),this._setLoading(!0),this.fire("request",{request:e,options:t},{bubbles:this.bubbles,composed:!0}),this.fire("iron-ajax-request",{request:e,options:t},{bubbles:this.bubbles,composed:!0}),e)},_handleResponse:function(e){e===this.lastRequest&&(this._setLastResponse(e.response),this._setLastError(null),this._setLoading(!1)),this.fire("response",e,{bubbles:this.bubbles,composed:!0}),this.fire("iron-ajax-response",e,{bubbles:this.bubbles,composed:!0})},_handleError:function(e,t){this.verbose&&a._error(t),e===this.lastRequest&&(this._setLastError({request:e,error:t,status:e.xhr.status,statusText:e.xhr.statusText,response:e.xhr.response}),this._setLastResponse(null),this._setLoading(!1)),this.fire("iron-ajax-error",{request:e,error:t},{bubbles:this.bubbles,composed:!0}),this.fire("error",{request:e,error:t},{bubbles:this.bubbles,composed:!0})},_discardRequest:function(e){var t=this.activeRequests.indexOf(e);t>-1&&this.splice("activeRequests",t,1)},_requestOptionsChanged:function(){this.debounce("generate-request",(function(){null!=this.url&&this.auto&&this.generateRequest()}),this.debounceDuration)}});var C={url:new URL("./elements/haxcms-elements/lib/core/haxcms-site-editor.js",document.baseURI).href},q=e("HAXCMSSiteEditor",function(e){function s(){var e;return m(this,s),(e=b(this,s)).__disposer=[],e.method="POST",e.editMode=!1,globalThis.SimpleModal.requestAvailability(),g((function(t){e.editMode=v(d.editMode),e.editMode&&v(E.activeHaxBody)&&E.activeHaxBody.importContent(v(d.activeItemContent)),e.__disposer.push(t)})),g((function(t){e.manifest=v(d.manifest),e.__disposer.push(t)})),g((function(t){e.activeItem=v(d.activeItem);var s=v(d.location.baseUrl);if(s&&e.activeItem&&e.activeItem.location){var a=s.replace("/sites","").split("/");5===a.length?E.revisionHistoryLink="/".concat(a[2],"/gitlist/").concat(a[3],"/logpatch/master/").concat(e.activeItem.location):4===a.length?E.revisionHistoryLink="/".concat(a[1],"/gitlist/").concat(a[2],"/logpatch/master/").concat(e.activeItem.location):3===a.length&&(E.revisionHistoryLink="/gitlist/".concat(a[1],"/logpatch/master/").concat(e.activeItem.location))}e.__disposer.push(t)})),e}return i(s,e),o(s,[{key:"render",value:function(){return r(S||(S=l(['\n      <style>\n        haxcms-site-editor {\n          display: block;\n        }\n\n        haxcms-site-editor[edit-mode] #editbutton {\n          width: 100%;\n          z-index: 100;\n          right: 0;\n          bottom: 0;\n          border-radius: 0;\n          height: 80px;\n          margin: 0;\n          padding: 8px;\n          background-color: lightblue !important;\n        }\n        h-a-x {\n          margin: auto;\n          display: none;\n        }\n        haxcms-site-editor[edit-mode] h-a-x {\n          display: block;\n        }\n      </style>\n      <iron-ajax\n        reject-with-request\n        .headers="','"\n        id="nodeupdateajax"\n        .url="','"\n        .method="','"\n        content-type="application/json"\n        handle-as="json"\n        @last-response-changed="','"\n        @last-error-changed="','"\n      ></iron-ajax>\n      <iron-ajax\n        reject-with-request\n        .headers="','"\n        id="outlineupdateajax"\n        .url="','"\n        .method="','"\n        content-type="application/json"\n        handle-as="json"\n        @response="','"\n        @last-error-changed="','"\n      ></iron-ajax>\n      <iron-ajax\n        reject-with-request\n        .headers="','"\n        id="manifestupdateajax"\n        .url="','"\n        .method="','"\n        content-type="application/json"\n        handle-as="json"\n        @response="','"\n        @last-error-changed="','"\n      ></iron-ajax>\n      <iron-ajax\n        reject-with-request\n        .headers="','"\n        id="publishajax"\n        .loading="','"\n        @loading-changed="','"\n        .url="','"\n        .method="','"\n        content-type="application/json"\n        handle-as="json"\n        @response="','"\n        @last-error-changed="','"\n      ></iron-ajax>\n      <iron-ajax\n        reject-with-request\n        .headers="','"\n        id="revertajax"\n        .url="','"\n        .method="','"\n        content-type="application/json"\n        handle-as="json"\n        @response="','"\n        @last-error-changed="','"\n      ></iron-ajax>\n      <iron-ajax\n        reject-with-request\n        .headers="','"\n        id="syncajax"\n        .url="','"\n        .method="','"\n        content-type="application/json"\n        handle-as="json"\n        @response="','"\n        @last-error-changed="','"\n      ></iron-ajax>\n      <iron-ajax\n        reject-with-request\n        .headers="','"\n        id="createajax"\n        .url="','"\n        .method="','"\n        content-type="application/json"\n        handle-as="json"\n        @response="','"\n        @last-error-changed="','"\n        @last-response-changed="','"\n      ></iron-ajax>\n      <iron-ajax\n        reject-with-request\n        .headers="','"\n        id="deleteajax"\n        .url="','"\n        .method="','"\n        content-type="application/json"\n        handle-as="json"\n        @response="','"\n        @last-error-changed="','"\n        @last-response-changed="','"\n      ></iron-ajax>\n      <iron-ajax\n        reject-with-request\n        .headers="','"\n        id="getuserdata"\n        url="','"\n        method="','"\n        content-type="application/json"\n        handle-as="json"\n        @response="','"\n        @last-error-changed="','"\n      ></iron-ajax>\n      <h-a-x\n        id="hax"\n        element-align="left"\n        offset-margin="48px 0 0 0"\n        hide-panel-ops="hide-panel-ops"\n        hide-toolbar="hide-toolbar"\n      ></h-a-x>\n    '])),{Authorization:"Bearer ${this.jwt}"},this.saveNodePath,this.method,this._handleNodeResponse,this.lastErrorChanged,{Authorization:"Bearer ${this.jwt}"},this.saveOutlinePath,this.method,this._handleOutlineResponse,this.lastErrorChanged,{Authorization:"Bearer ${this.jwt}"},this.saveManifestPath,this.method,this._handleManifestResponse,this.lastErrorChanged,{Authorization:"Bearer ${this.jwt}"},this.publishing,this.loadingChanged,this.publishSitePath,this.method,this._handlePublishResponse,this.lastErrorChanged,{Authorization:"Bearer ${this.jwt}"},this.revertSitePath,this.method,this._handleRevertResponse,this.lastErrorChanged,{Authorization:"Bearer ${this.jwt}"},this.syncSitePath,this.method,this._handleSyncResponse,this.lastErrorChanged,{Authorization:"Bearer ${this.jwt}"},this.createNodePath,this.method,this._handleCreateResponse,this.lastErrorChanged,this.__createNodeResponseChanged,{Authorization:"Bearer ${this.jwt}"},this.deleteNodePath,this.method,this._handleDeleteResponse,this.lastErrorChanged,this.__deleteNodeResponseChanged,{Authorization:"Bearer ${this.jwt}"},this.getUserDataPath,this.method,this._handleUserDataResponse,this.lastErrorChanged)}},{key:"__deleteNodeResponseChanged",value:function(e){e.detail.value&&e.detail.value.data&&e.detail.value.data.title&&(d.toast("Page deleted ".concat(e.detail.value.data.title,", selecting another page"),4e3),d.playSound("coin"))}},{key:"__createNodeResponseChanged",value:function(e){e.detail.value&&e.detail.value.data&&e.detail.value.data.slug&&(globalThis.history.pushState({},null,e.detail.value.data.slug),globalThis.dispatchEvent(new PopStateEvent("popstate")),d.toast("Created ".concat(e.detail.value.data.title,"!"),3e3,{hat:"random"}),d.playSound("coin"))}},{key:"_handleUserDataResponse",value:function(e){e.detail.response&&e.detail.response.data&&(d.userData=e.detail.response.data,this.dispatchEvent(new CustomEvent("haxcms-user-data-updated",{composed:!0,bubbles:!0,cancelable:!1,detail:e.detail.response.data})))}},{key:"lastErrorChanged",value:function(e){if(e.detail.value){console.error(e);var t=h(e)[0];switch(parseInt(e.detail.value.status)){case 405:case 401:this.dispatchEvent(new CustomEvent("jwt-login-logout",{composed:!0,bubbles:!0,cancelable:!1,detail:{redirect:!0}}));break;case 403:this.dispatchEvent(new CustomEvent("jwt-login-refresh-token",{composed:!0,bubbles:!0,cancelable:!1,detail:{element:{obj:this,callback:"refreshRequest",params:[t]}}}));break;default:d.toast(e.detail.value.status+" "+e.detail.value.statusText,5e3,{fire:!0}),d.playSound("error")}}}},{key:"refreshRequest",value:function(e,t){this.jwt=e,t.body.jwt=e,t.headers={Authorization:"Bearer ".concat(this.jwt)},setTimeout((function(){t.generateRequest()}),0)}},{key:"loadingChanged",value:function(e){this.loading=e.detail.value}},{key:"createRenderRoot",value:function(){return this}},{key:"firstUpdated",value:function(e){if(E.ready){this._storeReadyToGo({detail:!0})}globalThis.dispatchEvent(new CustomEvent("haxcms-site-editor-loaded",{bubbles:!0,composed:!0,cancelable:!1,detail:!0}));var t=globalThis.document.createElement("link");t.rel="stylesheet",t.href=new URL("../base.css",C.url).href,this.querySelector("#hax").shadowRoot.querySelector("style").parentNode.insertBefore(t,this.querySelector("#hax").shadowRoot.querySelector("style").nextSibling)}},{key:"updated",value:function(e){var t=this;e.forEach((function(e,s){"appStore"==s&&t.querySelector("#hax").setAttribute("app-store",JSON.stringify(t[s])),"publishing"==s?t._publishingChanged(t[s],e):"activeItem"==s?(t.dispatchEvent(new CustomEvent("manifest-changed",{detail:t[s]})),t._activeItemChanged(t[s],e)):"manifest"==s&&(t.dispatchEvent(new CustomEvent("manifest-changed",{detail:t[s]})),t._manifestChanged(t[s],e))}))}},{key:"_tokenRefreshFailed",value:function(e){this.dispatchEvent(new CustomEvent("jwt-login-logout",{composed:!0,bubbles:!0,cancelable:!1,detail:{redirect:!0}}))}},{key:"connectedCallback",value:function(){u(c(s.prototype),"connectedCallback",this).call(this),this.windowControllers&&this.windowControllers.abort(),this.windowControllers=new AbortController,globalThis.addEventListener("jwt-login-refresh-error",this._tokenRefreshFailed.bind(this),{signal:this.windowControllers.signal}),globalThis.addEventListener("hax-store-ready",this._storeReadyToGo.bind(this),{signal:this.windowControllers.signal}),globalThis.addEventListener("json-outline-schema-active-item-changed",this._newActiveItem.bind(this),{signal:this.windowControllers.signal}),globalThis.addEventListener("json-outline-schema-active-body-changed",this._bodyChanged.bind(this),{signal:this.windowControllers.signal}),globalThis.addEventListener("haxcms-save-outline",this.saveOutline.bind(this),{signal:this.windowControllers.signal}),globalThis.addEventListener("haxcms-save-node",this.saveNode.bind(this),{signal:this.windowControllers.signal}),globalThis.addEventListener("haxcms-save-site-data",this.saveManifest.bind(this),{signal:this.windowControllers.signal}),globalThis.addEventListener("haxcms-load-site-dashboard",this.loadSiteDashboard.bind(this),{signal:this.windowControllers.signal}),globalThis.addEventListener("haxcms-load-user-data",this.loadUserData.bind(this),{signal:this.windowControllers.signal}),globalThis.addEventListener("haxcms-create-node",this.createNode.bind(this),{signal:this.windowControllers.signal}),globalThis.addEventListener("haxcms-delete-node",this.deleteNode.bind(this),{signal:this.windowControllers.signal})}},{key:"loadUserData",value:function(e){this.querySelector("#getuserdata").body={jwt:this.jwt},this.querySelector("#getuserdata").generateRequest()}},{key:"loadSiteDashboard",value:function(e){var t=this;globalThis.document.body.querySelector("haxcms-site-dashboard")&&(this.siteDashboard=globalThis.document.body.querySelector("haxcms-site-dashboard"),this.siteDashboard.headers={Authorization:"Bearer ".concat(this.jwt)},this.siteDashboard.jwt=this.jwt,this.siteDashboard.method=this.method,this.siteDashboard.body={jwt:this.jwt,token:this.getFormToken,site:{name:this.manifest.metadata.site.name}},this.siteDashboard.loadEndpoint=this.getSiteFieldsPath,setTimeout((function(){t.siteDashboard.generateRequest()}),0))}},{key:"_schemaFormValueChanged",value:function(e){}},{key:"createNode",value:(n=y(f().mark((function e(s){var a,n,i=this;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!s.detail.values){e.next=15;break}if((a=s.detail.values).jwt=this.jwt,a.site={name:this.manifest.metadata.site.name},this._originalTarget=s.detail.originalTarget,!a.docximport){e.next=10;break}return e.next=8,t.import("./e170c499.js").then(function(){var e=y(f().mark((function e(s){var n,o,r,l,h;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return j(["haxcms"]),n=globalThis.FileSystemBroker.requestAvailability(),e.next=4,n.loadFile("docx");case 4:return o=e.sent,(r=new FormData).append("method",a.docximport),l="course",i.manifest.metadata.build&&i.manifest.metadata.structure&&(l=i.manifest.metadata.structure),r.append("type",l),r.append("parentId",a.parent),r.append("upload",o),i.setProcessingVisual(),e.next=15,w.call("@haxcms/docxToSite",r);case 15:if(h=e.sent,d.toast("finished!",300),200!=h.status||!h.data||""==h.data.contents){e.next=21;break}return a.items=h.data.items,e.next=21,t.import("./32e31e73.js").then(function(){var e=y(f().mark((function e(t){var s,n,o,r;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(s=globalThis.document.createElement("outline-designer")).items=h.data.items,s.eventData=a,s.storeTools=!0,(n=globalThis.document.createElement("button")).innerText="Confirm",n.classList.add("hax-modal-btn"),n.addEventListener("click",function(){var e=y(f().mark((function e(t){var a,n,o,r,l,d;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.getData();case 2:a=e.sent,n=0,o=0,r=0,a.items.map((function(e){e.delete?n++:e.new?r++:e.modified&&o++})),(""==(l="".concat(r>0?"‣ ".concat(r," new pages will be created\n"):"").concat(o>0?"‣ ".concat(o," pages will be updated\n"):"").concat(n>0?"‣ ".concat(n," pages will be deleted\n"):""))||globalThis.confirm("Saving will commit the following actions:\n".concat(l,"\nAre you sure?")))&&(i.querySelector("#createajax").body=a,i.setProcessingVisual(),i.querySelector("#createajax").generateRequest(),d=new CustomEvent("simple-modal-hide",{bubbles:!0,composed:!0,cancelable:!0,detail:{}}),globalThis.dispatchEvent(d));case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),(o=globalThis.document.createElement("button")).innerText="Cancel",o.classList.add("hax-modal-btn"),o.classList.add("cancel"),o.addEventListener("click",(function(e){var t=new CustomEvent("simple-modal-hide",{bubbles:!0,composed:!0,cancelable:!0,detail:{}});globalThis.dispatchEvent(t)})),(r=globalThis.document.createElement("div")).appendChild(n),r.appendChild(o),i.dispatchEvent(new CustomEvent("simple-modal-show",{bubbles:!0,cancelable:!0,composed:!0,detail:{title:"Confirm structure",elements:{content:s,buttons:r},modal:!0,styles:x(x(x({"--simple-modal-titlebar-background":"transparent","--simple-modal-titlebar-color":"black","--simple-modal-width":"90vw","--simple-modal-min-width":"300px","--simple-modal-z-index":"100000000","--simple-modal-height":"90vh","--simple-modal-min-height":"400px","--simple-modal-titlebar-height":"64px"},"--simple-modal-titlebar-color","black"),"--simple-modal-titlebar-height","80px"),"--simple-modal-titlebar-background","orange")}}));case 17:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 21:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 8:e.next=15;break;case 10:this.querySelector("#createajax").body=a,this.setProcessingVisual(),this.querySelector("#createajax").generateRequest(),n=new CustomEvent("simple-modal-hide",{bubbles:!0,composed:!0,cancelable:!0,detail:{}}),globalThis.dispatchEvent(n);case 15:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"_handleCreateResponse",value:function(e){this.dispatchEvent(new CustomEvent("haxcms-trigger-update",{bubbles:!0,composed:!0,cancelable:!1,detail:!0})),this.dispatchEvent(new CustomEvent("haxcms-create-node-success",{bubbles:!0,composed:!0,cancelable:!1,detail:{value:!0,originalTarget:this._originalTarget}}))}},{key:"deleteNode",value:function(e){this.querySelector("#deleteajax").body={jwt:this.jwt,site:{name:this.manifest.metadata.site.name},node:{id:e.detail.item.id}},this.setProcessingVisual(),this.querySelector("#deleteajax").generateRequest();var t=new CustomEvent("simple-modal-hide",{bubbles:!0,composed:!0,cancelable:!0,detail:{}});globalThis.dispatchEvent(t)}},{key:"_handleDeleteResponse",value:function(e){var t=this;globalThis.history.replaceState({},null,d.fallbackItemSlug()),globalThis.dispatchEvent(new PopStateEvent("popstate")),setTimeout((function(){t.dispatchEvent(new CustomEvent("haxcms-trigger-update",{bubbles:!0,composed:!0,cancelable:!1,detail:!0}))}),100)}},{key:"_storeReadyToGo",value:function(e){e.detail&&(E.connectionRewrites.appendJwt="jwt")}},{key:"_publishingChanged",value:function(e,t){e?d.toast("Publishing...",0,{hat:"random"}):!e&&t&&d.toast("Publishing...",2e3,{hat:"random"})}},{key:"_manifestChanged",value:function(e){this.activeItem&&e.metadata&&(E.connectionRewrites.appendUploadEndPoint="siteName="+e.metadata.site.name+"&nodeId="+this.activeItem.id)}},{key:"_newActiveItem",value:function(e){this.activeItem=e.detail}},{key:"_activeItemChanged",value:function(e,t){e&&this.manifest&&(E.connectionRewrites.appendUploadEndPoint="siteName="+this.manifest.metadata.site.name+"&nodeId="+e.id)}},{key:"_handleNodeResponse",value:function(e){e.detail.value&&e.detail.value.data&&e.detail.value.data.slug&&this.activeItem.slug!==e.detail.value.data.slug&&(globalThis.history.replaceState({},null,e.detail.value.data.slug),globalThis.dispatchEvent(new PopStateEvent("popstate"))),d.toast("Page saved!",3e3,{hat:"random"}),d.playSound("coin"),this.dispatchEvent(new CustomEvent("haxcms-trigger-update",{bubbles:!0,composed:!0,cancelable:!1,detail:!0})),this.dispatchEvent(new CustomEvent("haxcms-trigger-update-node",{bubbles:!0,composed:!0,cancelable:!1,detail:!0}))}},{key:"_handleOutlineResponse",value:function(e){var t=this;d.toast("Outline saved!",3e3,{hat:"random"}),d.playSound("coin"),setTimeout((function(){t.dispatchEvent(new CustomEvent("haxcms-trigger-update",{bubbles:!0,composed:!0,cancelable:!1,detail:!0}))}),100)}},{key:"_handleManifestResponse",value:function(e){d.toast("Site details saved, reloading to reflect changes!",2e3),d.playSound("coin"),this.dispatchEvent(new CustomEvent("haxcms-trigger-update",{bubbles:!0,composed:!0,cancelable:!1,detail:!0})),setTimeout((function(){globalThis.location.reload()}),2e3)}},{key:"_handleRevertResponse",value:function(e){d.toast("Last save undone",2e3),d.playSound("error"),this.dispatchEvent(new CustomEvent("haxcms-trigger-update",{bubbles:!0,composed:!0,cancelable:!1,detail:!0}))}},{key:"_handleSyncResponse",value:function(e){d.toast("Site synced",2e3,{hat:"random"}),d.playSound("success"),this.dispatchEvent(new CustomEvent("haxcms-trigger-update",{bubbles:!0,composed:!0,cancelable:!1,detail:!0}))}},{key:"_handlePublishResponse",value:function(e){var t=e.detail.response,s=globalThis.document.createElement("span");s.innerHTML='\n    <a href="'.concat(t.url,'" target="_blank">\n      <button raised style="color:yellow;text-transform: none;font-weight: bold;">\n      ').concat(t.label,"\n      </button>\n    </a>");var a=new CustomEvent("haxcms-toast-show",{bubbles:!0,composed:!0,cancelable:!0,detail:{text:t.response,duration:1e4,slot:s.cloneNode(!0)}});globalThis.dispatchEvent(a)}},{key:"saveNode",value:(a=y(f().mark((function e(t){var s;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.saveNodePath){e.next=15;break}return e.next=3,E.activeHaxBody.haxToContent();case 3:return s=e.sent,e.t0=this.jwt,e.t1={name:this.manifest.metadata.site.name},e.t2=this.activeItem.id,e.t3=s,e.next=10,E.htmlToHaxElements(s);case 10:e.t4=e.sent,e.t5={id:e.t2,body:e.t3,schema:e.t4},this.querySelector("#nodeupdateajax").body={jwt:e.t0,site:e.t1,node:e.t5},this.setProcessingVisual(),this.querySelector("#nodeupdateajax").generateRequest();case 15:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"saveNodeDetails",value:function(e){this.saveNodePath&&(this.querySelector("#nodeupdateajax").body={jwt:this.jwt,site:{name:this.manifest.metadata.site.name},node:{id:e.detail.id,details:e.detail}},this.setProcessingVisual(),this.querySelector("#nodeupdateajax").generateRequest())}},{key:"saveOutline",value:function(e){this.saveOutlinePath&&(this.querySelector("#outlineupdateajax").body={jwt:this.jwt,site:{name:this.manifest.metadata.site.name},items:e.detail},this.setProcessingVisual(),this.querySelector("#outlineupdateajax").generateRequest())}},{key:"setProcessingVisual",value:function(){var e=globalThis.document.createElement("simple-icon-lite");e.icon="hax:loading",e.style.setProperty("--simple-icon-height","40px"),e.style.setProperty("--simple-icon-width","40px"),e.style.height="150px",e.style.marginLeft="8px",d.toast("Processing",5e3,{hat:"construction",slot:e})}},{key:"saveManifest",value:function(e){var t=e.detail;t.manifest.theme&&t.manifest.theme.regions&&(Object.keys(t.manifest.theme.regions).forEach((function(e,s){t.manifest.theme.regions[e]&&t.manifest.theme.regions[e].length>0&&(t.manifest.theme[e]=t.manifest.theme.regions[e].map((function(e){return e.node?e.node:null})))})),delete t.manifest.theme.regions),t.cssVariable&&(t.hexCode=globalThis.SimpleColorsSharedStyles.colors[t.cssVariable.replace("--simple-colors-default-theme-","").replace("-7","")][6]),t.jwt=this.jwt,t.site?t.site.name=this.manifest.metadata.site.name:t.site={name:this.manifest.metadata.site.name},this.saveManifestPath&&(this.querySelector("#manifestupdateajax").body=t,this.setProcessingVisual(),this.querySelector("#manifestupdateajax").generateRequest())}},{key:"_bodyChanged",value:function(e){E.activeHaxBody&&E.activeHaxBody.importContent(e.detail)}},{key:"publishSite",value:function(e){this.publishSitePath&&(this.querySelector("#publishajax").body={jwt:this.jwt,site:{name:this.manifest.metadata.site.name}},this.setProcessingVisual(),this.querySelector("#publishajax").generateRequest())}},{key:"syncSite",value:function(e){this.syncSitePath&&(this.querySelector("#syncajax").body={jwt:this.jwt,site:{name:d.manifest.metadata.site.name}},this.setProcessingVisual(),this.querySelector("#syncajax").generateRequest())}},{key:"revertCommit",value:function(e){this.revertSitePath&&(this.querySelector("#revertajax").body={jwt:this.jwt,site:{name:d.manifest.metadata.site.name}},this.setProcessingVisual(),this.querySelector("#revertajax").generateRequest())}}],[{key:"tag",get:function(){return"haxcms-site-editor"}},{key:"properties",get:function(){return{getUserDataPath:{type:String,attribute:"get-user-data-path"},method:{type:String},jwt:{type:String},saveNodePath:{type:String,attribute:"save-node-path"},createNodePath:{type:String,attribute:"create-node-path"},deleteNodePath:{type:String,attribute:"delete-node-path"},saveManifestPath:{type:String,attribute:"save-manifest-path"},publishSitePath:{type:String,attribute:"publish-site-path"},revertSitePath:{type:String,attribute:"revert-site-path"},appendTarget:{type:Object},appElement:{type:Object},syncSitePath:{type:String,attribute:"sync-site-path"},publishing:{type:Boolean},saveOutlinePath:{type:String,attribute:"save-outline-path"},appStore:{type:Object},editMode:{type:Boolean,reflect:!0,attribute:"edit-mode"},activeItem:{type:Object},manifest:{type:Object},getSiteFieldsPath:{type:String,attribute:"save-site-fields-path"},getFormToken:{type:String,attribute:"get-form-token"}}}}]);var a,n}(p));customElements.define(q.tag,q)}}}));
