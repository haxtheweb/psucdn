System.register(["./5a6fff1c.js","./f3600b61.js","./8fcf3a6f.js"],(function(e,t){"use strict";var a,n,i,o,s,c,l,r,d,m,h,u,p,g,v,f,b,y,I,x,C,T,E,k,S,_,L;return{setters:[function(e){a=e._,n=e.a,i=e.i,o=e.b,s=e.e,c=e.f,l=e.x,r=e.K,d=e.N,m=e.$,h=e.aK,u=e.m,p=e.t,g=e.a6,v=e.aL,f=e.aM,b=e.u,y=e.U,I=e.r,x=e.c,C=e.d,T=e.p,E=e.aC,k=e.a2,S=e.aG,_=e.g,L=e.h},function(){},function(){}],execute:function(){var w,N,j={url:new URL("./elements/haxcms-elements/lib/core/haxcms-site-builder.js",document.baseURI).href};function A(e){e.matches?d.darkMode=!0:d.darkMode=!1}var M=e("HAXCMSSiteBuilder",function(e){function y(){var e;for(var t in x(this,y),(e=C(this,y)).windowControllers=new AbortController,e.t=s(s({},c(y,"t",e,1)),{},{pageNotFound:"Page not found",navigateToAnotherPageInTheMenu:"Navigate to another page in the menu",couldNotBeLocated:"could not be located",hereAreSomePossibleRemedies:"Here are some possible remedies:",useSearchToLocateTheContentYouAreLookingFor:"Use Search to locate the content you are looking for",goToTheHomePage:"Go to the home page"}),e.registerLocalization({context:e,namespace:"haxcms",localesPath:new URL("../../locales/haxcms.es.json",j.url).href.replace("/haxcms.es.json","/"),locales:["es"]}),e._timeStamp=Math.floor(Date.now()/1e3),e.disableFeatures="",e.isLoggedIn=!1,e.__disposer=[],e.queryParams={},e.loading=!1,e.__imported={},e.themeLoaded=!1,e.outlineLocation="",e.activeItemLocation="",h.storePieces.siteBuilder=e,e.children)if(e.children[t].tagName&&e.children[t].getAttribute("slot")){var a=e.children[t].cloneNode(!0),n=a.getAttribute("slot");switch(n){case"haxcms-site-editor-ui-prefix-avatar":case"haxcms-site-editor-ui-prefix-buttons":case"haxcms-site-editor-ui-suffix-buttons":case"haxcms-site-editor-ui-main-menu":case"haxcms-site-editor-ui-topbar-character-button":d.setupSlots[n].push(a)}}return globalThis.addEventListener("hax-store-ready",e.storeReady.bind(e),{signal:e.windowControllers.signal}),globalThis.addEventListener("haxcms-trigger-update",e._triggerUpdatedData.bind(e),{signal:e.windowControllers.signal}),globalThis.addEventListener("haxcms-trigger-update-node",e._triggerUpdatedNode.bind(e),{signal:e.windowControllers.signal}),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",A,{signal:e.windowControllers.signal}),u((function(){T("app-hax-darkMode",p(d.darkMode)),p(d.darkMode)?globalThis.document.body.classList.add("dark-mode"):globalThis.document.body.classList.remove("dark-mode")})),u((function(){e.isLoggedIn=p(d.isLoggedIn),E.writeMemory("isLoggedIn",e.isLoggedIn);var t=Math.floor(Date.now()/1e3);if(e.isLoggedIn&&!e.loggedInTime){e.loggedInTime=t,e._timeStamp=e.loggedInTime;var a=E.readMemory("recentLogins");a?a&&(a.length<5&&a.shift(),a.push(t),E.writeMemory("recentLogins",a,"long")):E.writeMemory("recentLogins",[t],"long")}})),u((function(){var e=p(E.memory),t=p(E.action);!1===e.editMode&&e.interactionDelay>=3600&&null===t.type&&d.cmsSiteEditor.haxCmsSiteEditorUIElement&&d.cmsSiteEditor.haxCmsSiteEditorUIElement.shadowRoot&&setTimeout((function(){d.cmsSiteEditor.haxCmsSiteEditorUIElement.shadowRoot.querySelector("#editbutton").dataPulse="1"}),300),E.active&&E.memory.isLoggedIn&&E.memory.recentTarget===k&&null===k.programName&&E.memory.interactionDelay>600&&["paste","key"].includes(t.type)?S(k.value)&&k.waveWand([k.value,"/",{},"hax-agent","Agent"],null,"coin2"):E.active&&E.memory.isLoggedIn&&null===k.programName&&["paste"].includes(t.type)&&"url"==E.data.architype&&k.waveWand([p(E.data.value),"/",{},"hax-agent","Agent"],null,"coin2")})),e}return a(y,e),n(y,[{key:"render",value:function(){return l(w||(w=o(['\n      <site-ai-chat></site-ai-chat>\n      <haxcms-site-router base-uri="','"></haxcms-site-router>\n      <simple-progress .disabled="','"></simple-progress>\n      <div id="slot"><slot></slot></div>\n      <slot name="haxcms-site-editor-ui-prefix-avatar"></slot>\n      <slot name="haxcms-site-editor-ui-prefix-buttons"></slot>\n      <slot name="haxcms-site-editor-ui-suffix-buttons"></slot>\n      <slot name="haxcms-site-editor-ui-main-menu"></slot>\n      <slot name="haxcms-site-editor-ui-topbar-character-button"></slot>\n      <simple-colors-polymer></simple-colors-polymer>\n    '])),this.baseURI,!this.loading)}},{key:"_updateManifest",value:function(e){this.manifest=s({},e)}},{key:"_updateLoading",value:function(e){this.loading=e.detail.value}},{key:"hashCode",value:function(e){return e.split("").reduce((function(e,t){return 0|(e=(e<<5)-e+t.charCodeAt(0))}),0)}},{key:"nodeNormalizeIDs",value:function(e){if(e.tagName&&null==e.getAttribute("id")&&["H1","H2","H3","H4","H5","H6"].includes(e.tagName))if(e.getAttribute("resource"))e.setAttribute("id",e.getAttribute("resource"));else{var t=e.tagName.toLowerCase()+"-"+this.hashCode(e.innerText);e.setAttribute("id",t)}}},{key:"_updateActiveItemContent",value:function(e){var t=this;if(e){var a=globalThis.document.createElement("div");a.innerHTML=e;var n,i=r(a.childNodes);try{for(i.s();!(n=i.n()).done;){var o=n.value;this.nodeNormalizeIDs(o)}}catch(e){i.e(e)}finally{i.f()}e=a.innerHTML,this.activeItemContent="",setTimeout((function(){t.activeItemContent=e}),0)}else d.cmsSiteEditorBackend.instance&&d.cmsSiteEditorBackend.instance.updateActiveItemContent?d.cmsSiteEditorBackend.instance.updateActiveItemContent():this.activeItemContent=""}},{key:"display404Error",value:function(){var e=this;if(d.themeElement){var t=globalThis.document.createDocumentFragment(),a=globalThis.document.createElement("p");a.innerHTML="<strong>".concat(d.getInternalRoute(),"</strong> ").concat(this.t.couldNotBeLocated,". ").concat(this.t.hereAreSomePossibleRemedies,'\n      <ul>\n        <li><a href="x/search?search=').concat(d.getInternalRoute(),'">').concat(this.t.useSearchToLocateTheContentYouAreLookingFor,'</a></li>\n        <li><a href="./">').concat(this.t.goToTheHomePage,"</a></li>\n        <li>").concat(this.t.navigateToAnotherPageInTheMenu,"</li>\n      </ul>"),t.appendChild(a),m(d.themeElement,"*"),d.themeElement.appendChild(t),setTimeout((function(){d.toast(e.t.pageNotFound,4e3,{fire:!0,walking:!0})}),1e3)}}},{key:"renderInternalRoute",value:function(){if(d.themeElement){var e=globalThis.document.createDocumentFragment();d.activeItem.component&&t.import("../ui-components/routes/".concat(d.activeItem.component,".js")).then((function(){var t=globalThis.document.createElement(d.activeItem.component);e.appendChild(t),m(d.themeElement,"*"),d.themeElement.appendChild(e)}))}}},{key:"loadPageData",value:(M=_(L().mark((function e(){var t,a=this;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.activeItemLocation||this.loading){e.next=11;break}if(this.loading=!0,t="".concat(this.outlineLocation).concat(this.activeItemLocation),this._timeStamp&&(-1!=t.indexOf("?")?t+="&".concat(this._timeStamp):t+="?".concat(this._timeStamp)),"hax-internal-route.html"!==this.activeItemLocation){e.next=9;break}this.renderInternalRoute(),this.loading=!1,e.next=11;break;case 9:return e.next=11,fetch(t).then((function(e){if(e.ok)return e.text();a.display404Error()})).then((function(e){a._updateActiveItemContent(e),a.loading=!1})).catch((function(e){a.lastErrorChanged(e)}));case 11:case"end":return e.stop()}}),e,this)}))),function(){return M.apply(this,arguments)})},{key:"loadJOSData",value:(I=_(L().mark((function e(){var t,a,n,i=this;return L().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.file){e.next=15;break}this.loading=!0,t="".concat(this.outlineLocation).concat(this.file),e.prev=3,a=JSON.parse(this.file),this._updateManifest(a),this.loading=!1,e.next=15;break;case 9:return e.prev=9,e.t0=e.catch(3),this._timeStamp&&""!=this._timeStamp&&(-1!=t.indexOf("?")?t+="&".concat(this._timeStamp):t+="?".concat(this._timeStamp)),n={cache:"no-cache"},e.next=15,fetch(t,n).then((function(e){if(e.ok)return e.json()})).then((function(e){i._updateManifest(e),i.loading=!1})).catch((function(e){i.lastErrorChanged(e)}));case 15:case"end":return e.stop()}}),e,this,[[3,9]])}))),function(){return I.apply(this,arguments)})},{key:"updated",value:function(e){var t=this;c(y,"updated",this,1)&&c(y,"updated",this,3)([e]);var a=!1,n=!1;e.forEach((function(e,i){["outlineLocation","activeItemLocation"].includes(i)&&""!=t[i]&&(n=!0),["outlineLocation","file"].includes(i)&&""!=t[i]&&(a=!0),"_timeStamp"==i&&t[i]&&(a=!0,n=!0),"themeData"==i?t._themeChanged(t[i],e):"themeName"==i?t._themeNameChanged(t[i],e):"outlineLocation"==i?t.dispatchEvent(new CustomEvent("outline-location-changed",{bubbles:!0,cancelable:!0,composed:!0,detail:t[i]})):"manifest"==i?(t.dispatchEvent(new CustomEvent("manifest-changed",{bubbles:!0,cancelable:!0,composed:!0,detail:t[i]})),t._manifestChanged(t[i],e)):"activeItem"==i?(t.dispatchEvent(new CustomEvent("active-item-changed",{bubbles:!0,cancelable:!0,composed:!0,detail:t[i]})),t._activeItemChanged(t[i],e)):"activeItemContent"==i&&(t.dispatchEvent(new CustomEvent("active-item-content-changed",{bubbles:!0,detail:t[i]})),t._activeItemContentChanged(t[i],e))})),a&&this.__ready&&this.loadJOSData(),n&&this.__ready&&this.loadPageData()}},{key:"_themeNameChanged",value:function(e){e&&(d.themeElement&&d.themeElement.remove(),m(this,"*"),d.themeElement=globalThis.document.createElement(e),d.themeElement.classList.add("haxcms-theme-element"),this.appendChild(d.themeElement))}},{key:"lastErrorChanged",value:function(e){e&&(console.error(e),e.detail&&e.detail.value?(window&&globalThis.location&&globalThis.appSettings&&globalThis.appSettings.reloadOnError&&globalThis.location.reload(),d.toast(e.detail.value.status+" "+e.detail.value.statusText,5e3,{fire:!0})):window&&globalThis.location&&globalThis.appSettings&&globalThis.appSettings.reloadOnError&&globalThis.location.reload())}},{key:"firstUpdated",value:function(e){var a=this;c(y,"firstUpdated",this,1)&&c(y,"firstUpdated",this,3)([e]),this.__ready=!0,d.appReady=!0,globalThis.dispatchEvent(new CustomEvent("haxcms-ready",{bubbles:!0,composed:!0,cancelable:!1,detail:this})),t.import("./80848cc6.js").then((function(e){t.import("./4259419a.js"),a.editorBuilder=globalThis.document.createElement("haxcms-editor-builder"),a.parentNode?a.parentNode.insertBefore(a.editorBuilder,a):globalThis.document.body.appendChild(a.editorBuilder),"published"!==h.getApplicationContext()?a._timeStamp=Math.floor(Date.now()/1e3):a._timeStamp=""})).catch((function(e){console.warn(e)})),globalThis.dispatchEvent(new Event("resize")),setTimeout((function(){u((function(e){if(a.themeData=p(d.themeData),a.themeData){var t=new URLSearchParams(globalThis.location.search),n=t.get("format");if(null!=n&&"print-page"===n)a.themeData.element="haxcms-print-theme";var i=t.get("disable-features");null!=i&&(a.disableFeatures=i)}a.themeData&&a.themeData.element!==a.themeName&&(a.themeName=a.themeData.element),a.__disposer.push(e)})),u((function(e){var t=p(d.activeItem);t&&t.location&&(a.activeItemLocation=t.location),a.__disposer.push(e)}))}),0)}},{key:"disconnectedCallback",value:function(){for(var e in this.__disposer)this.__disposer[e].dispose();this.windowControllers.abort(),c(y,"disconnectedCallback",this,3)([])}},{key:"storeReady",value:function(e){d.cmsSiteEditor&&d.cmsSiteEditor.instance&&globalThis.HaxStore.requestAvailability().activeHaxBody&&d.activeItemContent&&globalThis.HaxStore.requestAvailability().activeHaxBody.importContent(d.activeItemContent)}},{key:"replaceTagReplacement",value:function(e){for(var t=/\<(\w+?\-\w*.*)\s*?\>/gim,a=t.exec(e);null!=a;){var n=a[1].replace("<","").replace(">","");n.indexOf(" ")&&(n=n.split(" ")[0]),-1!=n.indexOf("-")&&(e=(e=e.replace("<"+n,'<replace-tag with="'+n+'" ')).replace("</"+n+">","</replace-tag>")),a=t.exec(e)}return e}},{key:"_activeItemContentChanged",value:function(e,a){var n=this;if(e){var i=e;null!==i&&d.activeItem&&d.activeItem.metadata&&(m(d.themeElement,"*"),e='<page-break\n        break-type="site"\n        title="'.concat(d.activeItem.title,'"\n        parent="').concat(d.activeItem.parent,'"\n        item-id="').concat(d.activeItem.id,'"\n        slug="').concat(d.activeItem.slug,'"\n        description="').concat(d.activeItem.description,'"\n        order="').concat(d.activeItem.order,'"\n        ').concat(d.activeItem.metadata.pageType?'page-type="'.concat(d.activeItem.metadata.pageType,'"'):"","\n        ").concat(d.activeItem.metadata.tags?'tags="'.concat(d.activeItem.metadata.tags,'"'):"","\n        ").concat(d.activeItem.metadata.hideInMenu?'hide-in-menu="hide-in-menu"':"","\n        ").concat(d.activeItem.metadata.relatedItems?'related-items="'.concat(d.activeItem.metadata.relatedItems,'"'):"","\n        ").concat(d.activeItem.metadata.image?'image="'.concat(d.activeItem.metadata.image,'"'):"","\n        ").concat(d.activeItem.metadata.icon?'icon="'.concat(d.activeItem.metadata.icon,'"'):"","\n        ").concat(d.activeItem.metadata.accentColor?'accent-color="'.concat(d.activeItem.metadata.accentColor,'"'):"","\n        ").concat(d.activeItem.metadata.theme&&d.activeItem.metadata.theme.key?'developer-theme="'.concat(d.activeItem.metadata.theme.key,'"'):"","\n        ").concat(d.activeItem.metadata.locked?'locked="locked"':"","\n        ").concat(!1===d.activeItem.metadata.published?"":'published="published"'," ></page-break>").concat(e),i=g(e),d.activeItemContent=i,setTimeout((function(){if(0===d.themeElement.childNodes.length){var e=document.createRange().createContextualFragment(n.replaceTagReplacement(i));d.themeElement.appendChild(e),n.dispatchEvent(new CustomEvent("json-outline-schema-active-body-changed",{bubbles:!0,composed:!0,cancelable:!1,detail:i}))}if(!globalThis.WCAutoload&&v(n.manifest,"metadata.node.dynamicElementLoader")){var a=f(i),o=new URL("./locales/haxcms.es.json",j.url).href+"/../";for(var s in a){var c=a[s];n.manifest.metadata.node.dynamicElementLoader[c]&&!globalThis.customElements.get(c)&&t.import("".concat(o,"../../../../").concat(n.manifest.metadata.node.dynamicElementLoader[c])).then((function(e){})).catch((function(e){console.warn(e)}))}}else globalThis.WCAutoload&&setTimeout((function(){globalThis.WCAutoload.process()}),0)}),5))}}},{key:"_activeItemChanged",value:function(e,t){this.shadowRoot&&e&&"undefined"!==b(e.id)?this.queryParams.nodeId=e.id:t&&!e&&this.dispatchEvent(new CustomEvent("json-outline-schema-active-body-changed",{bubbles:!0,composed:!0,cancelable:!1,detail:null}))}},{key:"_triggerUpdatedData",value:function(e){this.isLoggedIn?this._timeStamp=Math.floor(Date.now()/1e3):this._timeStamp=""}},{key:"_triggerUpdatedNode",value:function(e){this.loadPageData()}},{key:"_manifestChanged",value:function(e,t){e&&e.metadata&&e.items&&d.loadManifest(e,this)}},{key:"_themeChanged",value:function(e,a){var n=this;if(e){this.themeLoaded=!1;var i=e;if("undefined"!==b(this.__imported[i.element]))this.themeLoaded=!0;else if(globalThis.WCAutoload)this.__imported[i.element]=i.element,this.themeLoaded=!0,setTimeout((function(){globalThis.WCAutoload.process(),globalThis.dispatchEvent(new CustomEvent("haxcms-theme-ready",{bubbles:!0,composed:!0,cancelable:!1,detail:n}))}),5);else try{t.import(new URL("./../../../../../"+e.path,j.url).href).then((function(e){n.__imported[i.element]=i.element,n.themeLoaded=!0}))}catch(e){this.themeLoaded=!0}}}}],[{key:"styles",get:function(){return[i(N||(N=o(["\n        :host {\n          display: block;\n          position: relative;\n        }\n        :host([is-logged-in]) {\n          max-height: calc(100vh - 48px);\n        }\n        :host #slot {\n          opacity: 0.2;\n          visibility: hidden;\n        }\n        :host([theme-loaded]) #slot {\n          opacity: 1;\n          visibility: visible;\n        }\n        simple-progress {\n          display: block;\n          width: 100%;\n          position: fixed;\n          top: 0;\n          left: 0;\n          right: 0;\n          background-color: transparent;\n          z-index: 1000;\n          --simple-progress-active-color: var(\n            --haxcms-color,\n            rgba(255, 255, 255, 0.5)\n          );\n        }\n        simple-progress[disabled] {\n          display: none;\n        }\n      "])))]}},{key:"tag",get:function(){return"haxcms-site-builder"}},{key:"properties",get:function(){return s(s({},c(y,"properties",this)),{},{activeItemLocation:{type:String,attribute:"active-item-location"},disableFeatures:{type:String,reflect:!0,attribute:"disable-features"},_timeStamp:{type:String},isLoggedIn:{type:Boolean,reflect:!0,attribute:"is-logged-in"},queryParams:{type:Object},loading:{type:Boolean,reflect:!0},outlineLocation:{type:String,attribute:"outline-location"},manifest:{type:Object},themeData:{type:Object},themeName:{type:String},__imported:{type:Object},themeLoaded:{type:Boolean,reflect:!0,attribute:"theme-loaded"},activeItemContent:{type:String},file:{type:String},baseURI:{type:String,attribute:"base-uri"}})}}]);var I,M}(y(I)));globalThis.HAXme=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;null==e&&(e="demo",globalThis.appSettings={login:"dist/dev/login.json",logout:"dist/dev/logout.json",saveNodePath:"dist/dev/saveNode.json",saveManifestPath:"dist/dev/saveManifestPath.json",createNodePath:"dist/dev/saveNode.json",deleteNodePath:"dist/dev/saveNode.json",saveOutlinePath:"dist/dev/saveNode.json",publishSitePath:"dist/dev/saveNode.json",syncSitePath:"dist/dev/saveNode.json",getSiteFieldsPath:"dist/dev/getSiteFieldsPath.json",revertSitePath:"dist/dev/saveNode.json",getFormToken:"adskjadshjudfu823u823u8fu8fij",appStore:{url:"dist/dev/appstore.json"},jwt:"made-up-thing",themes:{"haxcms-dev-theme":{element:"haxcms-dev-theme",path:"@haxtheweb/haxcms-elements/lib/haxcms-dev-theme.js",name:"Developer theme"}}}),"demo"==e&&(globalThis.HAXCMSContext="demo"),globalThis.document.body&&(globalThis.document.body.querySelector("haxcms-editor-builder").__appliedContext=!1,globalThis.document.body.querySelector("haxcms-editor-builder").applyContext(e))},customElements.define(M.tag,M)}}}));
