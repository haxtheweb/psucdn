System.register(["./be7cca87.js","./6f58b968.js"],(function(e){"use strict";var t,n,i,o,a,s,r,d,l,c,p,h,u,m,g,f,v,b,k,y,x,w,A;return{setters:[function(e){t=e._,n=e.a,i=e.i,o=e.b,a=e.N,s=e.k,r=e.as,d=e.a7,l=e.a4,c=e.b6,p=e.f,h=e.g,u=e.b7,m=e.U,g=e.h,f=e.c,v=e.d,b=e.p,k=e.t,y=e.j,x=e.l,w=e.q},function(e){A=e.H}],execute:function(){var T,I,C,L,D,_,P,E,O,M,N,S,U,H={url:new URL("./elements/outline-designer/outline-designer.js",document.baseURI).href},R=e("OutlineDesigner",function(e){function m(){var e;return f(this,m),(e=v(this,m))._blurBlock=!1,e.fidelity="medium",e.haxGizmos=[],e.hideDelete=!1,e.activeItemForActions=null,e.storeTools=!1,e.hideContentOps=!1,e.items=[],e.appReady=!1,e.eventData={},e.activeId=null,e.activePreview=null,e.activePreviewIndex=-1,e.t={selectTarget:"Select target",importContentUnderThisPage:"Import content under this page",importThisContent:"Import this content",thisPage:"this page",newPage:"New page",copyOf:"Copy of"},e.registerLocalization({context:e,basePath:H.url,locales:["es"]}),b((function(){e.activeId=k(a.activeId)})),b((function(){e.appReady=k(a.appReady)})),b((function(){e.haxGizmos=k(A.gizmoList).filter((function(e){return!!(e&&e.meta&&e.meta.outlineDesigner)}))})),e.addEventListener("click",e.resetPopOver.bind(e)),e}return t(m,e),n(m,[{key:"resetPopOver",value:function(){this.activePreview&&(this.shadowRoot.querySelector("simple-popover").setAttribute("hidden","hidden"),this.activePreview=null,this.activePreviewIndex=-1)}},{key:"getSiteItems",value:function(){var e=[{text:this.t.selectTarget,value:null}];if(this.appReady&&this.items.length>0){var t=a.getManifestItems(!0);t.forEach((function(n){for(var i=n,o="- ";i&&null!=i.parent;)i=t.find((function(e){return e.id==i.parent})),i&&(o="--"+o);e.push({text:o+n.title,value:n.id})}))}return e}},{key:"render",value:function(){var e=this;return s(T||(T=o([' <div class="controls">\n        ','\n        <simple-icon-button-lite\n          class="control"\n          icon="add"\n          @click="','"\n          >Add page</simple-icon-button-lite\n        >\n        <simple-icon-button-lite\n          icon="hardware:keyboard-arrow-right"\n          @click="','"\n          class="control"\n          >Collapse all</simple-icon-button-lite\n        >\n        <simple-icon-button-lite\n          icon="hardware:keyboard-arrow-down"\n          @click="','"\n          class="control"\n          >Expand all</simple-icon-button-lite\n        >\n        ','\n      </div>\n      <ul id="list">\n        ','\n      </ul>\n      <simple-popover auto for="list" hidden>\n        <simple-icon-button\n          @click="','"\n          title="Close"\n          icon="cancel"\n          class="close-btn"\n        ></simple-icon-button>\n        ',"\n      </simple-popover>"])),this.storeTools?s(I||(I=o(['\n              <label for="targetselector">','</label>\n              <simple-fields-field\n                id="targetselector"\n                type="select"\n                value="children"\n                .itemsList="','"\n              ></simple-fields-field>\n              ',':\n              <simple-fields-field\n                id="itemselector"\n                type="select"\n                value="','"\n                .itemsList="','"\n              ></simple-fields-field>\n              <label for="itemselector"\n                >',"</label\n              >\n            "])),this.t.importThisContent,[{text:"as children of",value:"children"},{text:"Above",value:"above"},{text:"Below",value:"below"}],this.t.thisPage,this.activeId,this.getSiteItems(),this.t.importContentUnderThisPage):"",this.addItemToTop,this.collapseAll,this.expandAll,this.hasDeletedItems()?s(C||(C=o(['<simple-icon-button-lite\n              icon="delete"\n              @click="','"\n              class="control"\n              >',"</simple-icon-button-lite\n            >"])),this.toggleDelete,this.hideDelete?"Show Deleted":"Hide Deleted"):"",this.items.map((function(t,n){return""===e.getItemParentsCollapsed(t)?e.renderItem(t,n):""})),this.resetPopOver,this.renderActiveContentItem(this.activePreview,this.activePreviewIndex))}},{key:"hasDeletedItems",value:function(){return!!this.items.find((function(e){return 1==e.delete}))}},{key:"toggleDelete",value:function(e){this.hideDelete=!this.hideDelete}},{key:"renderActiveContentItem",value:function(e,t){if(e&&-1!=t){var n=this.items.find((function(t){return t.id===e.getAttribute("data-content-parent-id")}));if(n.contents){var i=globalThis.document.createElement("div");i.innerHTML=n.contents;for(var a=0;a<i.childNodes.length;a++){var l=i.childNodes[a];if(a===t)return s(L||(L=o(["",""])),r(d(l.outerHTML)))}}}}},{key:"setActiveItemForActions",value:function(e){this.activeItemForActions=e.target.closest("[data-item-id]").getAttribute("data-item-id")}},{key:"renderItem",value:function(e,t){var n=this;return s(D||(D=o(['\n      <li\n        @dragenter="','"\n        @dragleave="','"\n        @mouseenter="','"\n        class="item indent-'," "," ",'"\n        data-item-id="','"\n        @focusin="','"\n        data-parents="','"\n        ?data-has-children="','"\n        ?data-about-to-delete="','"\n        ?hidden="','"\n      >\n        <simple-icon-button\n          ?disabled="','"\n          class="collapse-btn"\n          icon="','"\n          @click="','"\n        ></simple-icon-button>\n        <simple-icon-button\n          ?disabled="','"\n          @dragstart="','"\n          @dragend="','"\n          draggable="','"\n          icon="hax:arrow-all"\n        ></simple-icon-button>\n        <simple-icon-button-lite\n          ?disabled="','"\n          ?hidden="','"\n          icon="editor:insert-drive-file"\n          @click="','"\n          title="Content structure"\n        >\n          ','\n        </simple-icon-button-lite>\n        <span\n          class="label shown"\n          ?disabled="','"\n          @dblclick="','"\n          >','</span\n        >\n        <span\n          class="label-edit"\n          @blur="','"\n          @keypress="','"\n          @keydown="','"\n        ></span>\n        <div class="operations">\n          ',"\n        </div>\n      </li>\n      ","\n    "])),this._dragEnter,this._dragLeave,this.setActiveItemForActions,e.indent<20?e.indent:20,e.modified?"modified":"",this.getItemParentsCollapsed(e),e.id,this.setActiveItemForActions,this.getItemParents(e),this.hasChildren(e.id),e.delete,this.hideDelete&&e.delete,this.isLocked(t),this.isCollapsed(e.id)?"hardware:keyboard-arrow-right":"hardware:keyboard-arrow-down",this.collapseExpand,this.isLocked(t),this._dragStart,this._dragEnd,!this.isLocked(t),this.isLocked(t),this.hideContentOps||""===e.contents||!e.contents,this.toggleContent,e.new?s(_||(_=o(['<simple-icon\n                ?disabled="','"\n                icon="av:fiber-new"\n                title="','"\n                class="new"\n                accent-color="green"\n                dark\n                contrast="1"\n              ></simple-icon>'])),this.isLocked(t),this.t.newPage):"",this.isLocked(t),this.editTitle,e.title,this.blurTitle,this.monitorTitle,this.monitorEsc,this.activeItemForActions===e.id?s(P||(P=o(['\n                <div class="btn-contrast">\n                  <simple-icon-button\n                    part="lockbtn"\n                    class="operation lock"\n                    icon="','"\n                    @click="','"\n                    title="Lock / Unlock"\n                  ></simple-icon-button>\n                  <simple-icon-button\n                    class="operation"\n                    icon="hax:outline-designer-outdent"\n                    @click="','"\n                    title="Move next to parent"\n                    ?disabled="','"\n                  ></simple-icon-button>\n                  <simple-icon-button\n                    class="operation"\n                    icon="hax:keyboard-arrow-up"\n                    @click="','"\n                    title="Move up"\n                    ?disabled="','"\n                  ></simple-icon-button>\n                  <simple-icon-button\n                    class="operation"\n                    icon="hax:keyboard-arrow-down"\n                    @click="','"\n                    title="Move down"\n                    ?disabled="','"\n                  ></simple-icon-button>\n                  <simple-icon-button\n                    class="operation"\n                    icon="hax:outline-designer-indent"\n                    @click="','"\n                    title="Make child"\n                    ?disabled="','"\n                  ></simple-icon-button>\n                </div>\n                <simple-icon-button\n                  class="operation add"\n                  icon="add"\n                  accent-color="green"\n                  @click="','"\n                  title="Add"\n                  ?disabled="','"\n                ></simple-icon-button>\n                <simple-icon-button\n                  class="operation"\n                  icon="content-copy"\n                  accent-color="green"\n                  @click="','"\n                  title="Duplicate"\n                  ?disabled="','"\n                ></simple-icon-button>\n                <simple-icon-button\n                  class="operation del"\n                  icon="','"\n                  accent-color="red"\n                  @click="','"\n                  title="','"\n                  ?disabled="','"\n                ></simple-icon-button>\n                <simple-icon-button\n                  class="operation goto"\n                  icon="open-in-browser"\n                  accent-color="blue"\n                  @click="','"\n                  title="Go to page"\n                ></simple-icon-button>\n              '])),this.isLocked(t)?"icons:lock":"icons:lock-open",(function(e){return n.itemOp(t,"lock")}),(function(e){return n.itemOp(t,"out")}),this.isLocked(t),(function(e){return n.itemOp(t,"up")}),this.isLocked(t),(function(e){return n.itemOp(t,"down")}),this.isLocked(t),(function(e){return n.itemOp(t,"in")}),this.isLocked(t),(function(e){return n.itemOp(t,"add")}),this.isLocked(t),(function(e){return n.itemOp(t,"duplicate")}),this.isLocked(t),e.delete?"hax:delete-restore":"delete",(function(e){return n.itemOp(t,"delete")}),e.delete?"Restore":"Delete",this.isLocked(t),(function(e){return n.itemOp(t,"goto")})):"",!this.hideContentOps&&e.showContent?this.renderItemContents(e):"")}},{key:"hasContents",value:function(e){return!(!e.contents||""==e.contents)}},{key:"renderItemContents",value:function(e){var t=this,n=[this.itemContentsOperations(e)];if(e.contents){var i=globalThis.document.createElement("div");i.innerHTML=e.contents;var o=1,a=0;i.childNodes.forEach((function(i,s){a=0,["h1","h2","h3","h4","h5","h6"].includes(i.tagName.toLowerCase())&&(o=parseInt(i.tagName.toLowerCase().replace("h","")),a=-1),n.push(t.renderNodeAsItem(i,s,e,parseInt(e.indent)+o+a))}))}return n}},{key:"itemContentsOperations",value:function(e){var t=this;return s(E||(E=o([' <li\n      class="item content-adding-operations indent-','"\n      data-item-for-content-id="','"\n      ?data-contents-collapsed="','"\n      ?data-about-to-delete="','"\n      ?hidden="','"\n    >\n      ',"\n    </li>"])),e.indent<20?e.indent:20,e.id,!e.showContent,e.delete,this.hideDelete&&e.delete,this.haxGizmos.map((function(e){return s(O||(O=o(['\n          <simple-icon-button-lite\n            class="operation"\n            icon="','"\n            value="','"\n            @click="','"\n            >Add ',"</simple-icon-button-lite\n          >\n        "])),e.icon,e.tag,t.prependNodeToContent,e.title)})))}},{key:"prependNodeToContent",value:function(e){var t=this,n=e.target.closest("[data-item-for-content-id]").getAttribute("data-item-for-content-id");this.items.map((function(i,o){if(i.id===n&&e.target.value){var a,s=A.haxSchemaFromTag(e.target.value);a=s.gizmo&&s.gizmo.tag&&s.demoSchema&&s.demoSchema[0]?l(s.demoSchema[0]):globalThis.document.createElement(tag),t.items[o].contents=a.outerHTML+i.contents,t.resetPopOver(),t.__syncUIAndDataModel()}}))}},{key:"renderNodeAsItem",value:function(e,t,n,i){var a=this,r=e.tagName.toLowerCase(),d="hax:bricks",l=r,c="non-heading",p=A.haxSchemaFromTag(r);if(p&&p.gizmo)switch(d=p.gizmo.icon,l=p.gizmo.title,r){case"h1":case"h2":case"h3":case"h4":case"h5":case"h6":l=e.innerText,c="heading"}return s(M||(M=o([' <li\n      class="item content-child content-'," indent-",'"\n      data-node-index="','"\n      data-content-parent-id="','"\n      ?data-contents-collapsed="','"\n      ?data-about-to-delete="','"\n      ?hidden="','"\n    >\n      <div class="btn-contrast">\n        <simple-icon-button-lite\n          icon="','"\n          title="Click to preview"\n          @click="','"\n        ></simple-icon-button-lite>\n      </div>\n      ','\n      <div class="content-operations">\n        <simple-icon-button\n          class="content-operation"\n          icon="hax:outline-designer-outdent"\n          @click="','"\n          title="Increase heading"\n          ?disabled="','"\n          ?hidden="','"\n        ></simple-icon-button>\n        <simple-icon-button\n          icon="hax:keyboard-arrow-up"\n          @click="','"\n          title="Move up"\n          ?disabled="','"\n          class="content-operation"\n        ></simple-icon-button>\n        <simple-icon-button\n          icon="hax:keyboard-arrow-down"\n          @click="','"\n          title="Move down"\n          ?disabled="','"\n          class="content-operation"\n        ></simple-icon-button>\n        <simple-icon-button\n          class="content-operation"\n          icon="hax:outline-designer-indent"\n          @click="','"\n          title="Decrease Heading"\n          ?disabled="','"\n          ?hidden="','"\n        ></simple-icon-button>\n        <simple-icon-button\n          class="content-operation"\n          icon="editor:format-page-break"\n          @click="','"\n          title="Promote to page"\n          ?disabled="','"\n          ?hidden="','"\n        ></simple-icon-button>\n        <simple-icon-button\n          icon="delete"\n          @click="','"\n          class="content-operation del"\n          title="Delete"\n          ?disabled="','"\n          accent-color="red"\n        ></simple-icon-button>\n      </div>\n    </li>'])),c,i<20?i:20,t,n.id,!n.showContent,n.delete,this.hideDelete&&n.delete,d,this.setActivePreview,"heading"===c?s(N||(N=o(['\n            <span\n              class="label shown"\n              ?disabled="','"\n              @dblclick="','"\n              >','</span\n            >\n            <span\n              class="label-edit"\n              @keypress="','"\n              @keydown="','"\n            ></span>\n          '])),n.metadata.locked,this.editTitle,l,this.monitorHeading,this.monitorEsc):s(S||(S=o(['<span class="label shown">',"</span>"])),l),(function(e){return a.modifyContentAction(e,n,"in")}),"h1"===r||n.metadata.locked,"heading"!==c,(function(e){return a.modifyContentAction(e,n,"up")}),n.metadata.locked,(function(e){return a.modifyContentAction(e,n,"down")}),n.metadata.locked,(function(e){return a.modifyContentAction(e,n,"out")}),"h6"===r||n.metadata.locked,"heading"!==c,(function(e){return a.pageBreakHere(e,n)}),n.metadata.locked,"heading"!==c,(function(e){return a.modifyContentAction(e,n,"delete")}),n.metadata.locked)}},{key:"setActivePreview",value:function(e){var t=e.target.closest("[data-content-parent-id]"),n=parseInt(t.getAttribute("data-node-index"));this.activePreview=t,this.shadowRoot.querySelector("simple-popover").removeAttribute("hidden"),this.shadowRoot.querySelector("simple-popover").target=t,this.activePreviewIndex=n,e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation()}},{key:"modifyContentAction",value:function(e,t,n){if(!t.metadata.locked){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation();var i=e.target.closest("[data-content-parent-id]"),o=i.getAttribute("data-content-parent-id"),a=parseInt(i.getAttribute("data-node-index")),s=this.items.find((function(e){return e.id===o}));if(s.contents){var r=globalThis.document.createElement("div");r.innerHTML=s.contents;var d="";switch(n){case"up":0!==a&&r.childNodes[a].previousElementSibling.insertAdjacentElement("beforebegin",r.childNodes[a]);break;case"down":a!==r.childNodes.length-1&&r.childNodes[a].nextElementSibling.insertAdjacentElement("afterend",r.childNodes[a])}for(var l=0;l<r.childNodes.length;l++){var c=r.childNodes[l];if(l<a)d+=c.outerHTML;else if(l===a)switch(n){case"delete":this.setAttribute("stop-animation","true");break;case"up":case"down":d+=c.outerHTML;break;case"in":case"out":var p=parseInt(c.tagName.toLowerCase().replace("h","")),h=void 0;"in"===n&&p>1?(h=globalThis.document.createElement("h".concat(p-1))).innerText=c.innerText:"out"===n&&p<6?(h=globalThis.document.createElement("h".concat(p+1))).innerText=c.innerText:h=c,d+=h.outerHTML}else d+=c.outerHTML}s.contents=d,this.resetPopOver(),this.__syncUIAndDataModel()}}}},{key:"pageBreakHere",value:function(e,t){if(!t.metadata.locked){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation();var n,i=e.target.closest("[data-content-parent-id]"),o=i.getAttribute("data-content-parent-id"),a=parseInt(i.getAttribute("data-node-index")),s=this.items.find((function(e){return e.id===o}));if(this.items.map((function(e,t){return e.id===o?n=t:null})),s.contents){var r=globalThis.document.createElement("div");r.innerHTML=s.contents;for(var d="",l="",p=this.t.newPage,h=0;h<r.childNodes.length;h++){var u=r.childNodes[h];h<a?d+=u.outerHTML:h===a?""!=u.innerText&&(p=u.innerText):l+=u.outerHTML}s.contents=d;var m=new c;m.title=p,m.order=s.order+1,m.parent=s.parent,m.indent=s.indent,m.metadata.locked=!1,m.new=!0,m.contents=l,this.items[n].modified=!0,this.items.splice(n+1,0,m),this.resetPopOver(),this.__syncUIAndDataModel()}}}},{key:"__syncUIAndDataModel",value:function(){var e=this;this._recurseUpdateIndent(),this._schemaOrderUpdate(),setTimeout((function(){e.requestUpdate(),setTimeout((function(){e.removeAttribute("stop-animation")}),300)}),0)}},{key:"collapseAll",value:function(){var e=this;this.items.map((function(t,n){e.hasChildren(t.id)&&!t.collapsed&&(e.items[n].collapsed=!0)})),setTimeout((function(){e.requestUpdate()}),0)}},{key:"expandAll",value:function(){var e=this;this.items.map((function(t,n){e.hasChildren(t.id)&&t.collapsed&&(e.items[n].collapsed=!1)})),setTimeout((function(){e.requestUpdate()}),0)}},{key:"getItemParents",value:function(e){for(var t=this.items.find((function(t){return t.id==e.parent})),n="";t;)n+=t.id+" ",t=this.items.find((function(e){return e.id==t.parent}));return n}},{key:"getItemParentsCollapsed",value:function(e){for(var t=this.items.find((function(t){return t.id==e.parent})),n="";t;)t.collapsed&&t.id&&(n+="collapsed-by-".concat(t.id)+" "),t=this.items.find((function(e){return e.id==t.parent}));return n}},{key:"isCollapsed",value:function(e){return!!this.items.find((function(t){return t.id==e})).collapsed}},{key:"hasChildren",value:function(e){return!!this.items.find((function(t){return t.parent==e}))}},{key:"collapseExpand",value:function(e){var t=this,n=e.target.closest("[data-item-id]").getAttribute("data-item-id");this.items.map((function(e,i){e.id!==n||t.isLocked(i)||(t.items[i].collapsed?t.items[i].collapsed=!1:t.items[i].collapsed=!0,t.requestUpdate())}))}},{key:"toggleContent",value:function(e){var t=this,n=e.target.closest("[data-item-id]");if(n&&!e.target.disabled){var i=n.getAttribute("data-item-id");this.items.map((function(e,n){e.id===i&&(t.items[n].showContent?t.items[n].showContent=!1:t.items[n].showContent=!0)})),this.requestUpdate()}}},{key:"editTitle",value:function(e){e.target.classList.remove("shown");var t=e.target.nextElementSibling;if(t.setAttribute("contenteditable","true"),t.classList.add("shown"),t.innerText=e.target.innerText,t.focus(),this.shadowRoot.getSelection){var n=globalThis.document.createRange();n.selectNodeContents(t),this.shadowRoot.getSelection().removeAllRanges(),this.shadowRoot.getSelection().addRange(n)}else try{globalThis.document.execCommand("selectAll",!1,null)}catch(e){console.warn(e)}}},{key:"monitorTitle",value:function(e){if("Enter"===e.key){e.target.classList.remove("shown"),e.target.previousElementSibling.classList.add("shown"),e.target.removeAttribute("contenteditable");for(var t=e.target.closest("[data-item-id]").getAttribute("data-item-id"),n=0;n<this.items.length;n++)this.items[n].id===t&&""!=e.target.innerText&&(this.items[n].new||(this.items[n].modified=!0),this.items[n].title=e.target.innerText);this.requestUpdate()}}},{key:"monitorHeading",value:function(e){if("Enter"===e.key){e.target.classList.remove("shown"),e.target.previousElementSibling.classList.add("shown"),e.target.removeAttribute("contenteditable");var t=e.target.closest("[data-content-parent-id]"),n=t.getAttribute("data-content-parent-id"),i=parseInt(t.getAttribute("data-node-index")),o=this.items.find((function(e){return e.id===n}));if(o.contents){var a=globalThis.document.createElement("div");a.innerHTML=o.contents;for(var s="",r=0;r<a.childNodes.length;r++){var d=a.childNodes[r];r<i?s+=d.outerHTML:r===i?(d.innerText=e.target.innerText,s+=d.outerHTML):s+=d.outerHTML}o.contents=s,this.resetPopOver(),this.requestUpdate()}}}},{key:"monitorEsc",value:function(e){"Escape"===e.key?(e.target.classList.remove("shown"),e.target.removeAttribute("contenteditable"),e.target.previousElementSibling.classList.add("shown"),e.target.innerText=e.target.previousElementSibling.innerText):"Enter"===e.key&&(this._blurBlock=!0)}},{key:"blurTitle",value:function(e){var t=this;this._blurBlock||(e.target.classList.remove("shown"),e.target.removeAttribute("contenteditable"),e.target.previousElementSibling.classList.add("shown"),e.target.innerText=e.target.previousElementSibling.innerText),setTimeout((function(){t._blurBlock=!1}),0)}},{key:"_mouseDownDrag",value:function(e){var t=this,n=e.target.closest("[data-item-id]").getAttribute("data-item-id");this.items.map((function(e,i){e.id===n&&t.hasChildren(e.id)&&(t.items[i].collapsed=!0)})),setTimeout((function(){t.requestUpdate()}),0)}},{key:"_dragEnter",value:function(e){this._targetDrop!==e.target.closest("[data-item-id]")&&(e.preventDefault(),e.target.closest("[data-item-id]").classList.add("outline-designer-hovered"),this._targetDrop=e.target.closest("[data-item-id]"))}},{key:"_dragLeave",value:function(e){this._targetDrop!==e.target.closest("[data-item-id]")&&e.target.closest("[data-item-id]").classList.remove("outline-designer-hovered")}},{key:"_dragEnd",value:function(e){if(this._targetDrag&&this._targetDrop){for(var t=null,n=null,i=0;i<this.items.length;i++){var o=this.items[i];o.id===this._targetDrop.getAttribute("data-item-id")&&(t=i),o.id===this._targetDrag.getAttribute("data-item-id")&&(n=i)}null!==n&&null!==t&&(this.items[n].new||(this.items[n].modified=!0),this.items[n].order=this.items[t].order,0===this.items[n].order&&(this.items[n].order=-1),this.items[n].indent=this.items[t].indent,this.items[n].parent=this.items[t].parent,this.hasChildren(this.items[n].id)&&(this.items[n].collapsed=!1)),this._targetDrag=null,this._targetDrop=null,this.setAttribute("stop-animation","true"),this.__syncUIAndDataModel()}}},{key:"_dragStart",value:function(e){if(null==e.target.getAttribute("disabled")){var t=e.target.closest("[data-item-id]");this._targetDrop=null,this._targetDrag=t,this._mouseDownDrag(e),e.dataTransfer&&(e.dataTransfer.effectAllowed="move",e.dataTransfer.dropEffect="move",e.dataTransfer.setDragImage(t,24,16)),e.stopPropagation(),e.stopImmediatePropagation()}}},{key:"updated",value:function(e){var t=this;p(h(m.prototype),"updated",this).call(this,e),e.forEach((function(e,n){"fidelity"===n&&t[n]&&t[n],"activePreview"===n&&e&&e.classList.remove("active-preview-item"),"activePreview"===n&&t[n]&&t[n].classList.add("active-preview-item")}))}},{key:"firstUpdated",value:function(e){var t=this;p(h(m.prototype),"firstUpdated",this)&&p(h(m.prototype),"firstUpdated",this).call(this,e),this.items&&setTimeout((function(){t.__syncUIAndDataModel()}),0)}},{key:"addItemToTop",value:function(){this.setAttribute("stop-animation","true"),this.addNewItem("top"),this.__syncUIAndDataModel()}},{key:"getData",value:(g=y(x().mark((function e(){var t,n,i,o;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((t=this.eventData).items=w(this.items),!this.storeTools){e.next=8;break}return n=this.shadowRoot.querySelector("#itemselector").value,i=this.shadowRoot.querySelector("#targetselector").value,o=0,e.next=8,t.items.map(function(){var e=y(x().mark((function e(s,r){var d;return x().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n||null!=s.parent){e.next=16;break}return o++,e.next=4,a.findItemAsObject(n);case 4:d=e.sent,e.t0=i,e.next="below"===e.t0?8:"above"===e.t0?11:"children"===e.t0?14:16;break;case 8:return t.items[r].parent=d.parent,t.items[r].order=parseInt(d.order)+o,e.abrupt("break",16);case 11:return t.items[r].parent=d.parent,t.items[r].order=parseInt(d.order)-o,e.abrupt("break",16);case 14:return t.items[r].parent=n,e.abrupt("break",16);case 16:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}());case 8:return e.abrupt("return",t);case 9:case"end":return e.stop()}}),e,this)}))),function(){return g.apply(this,arguments)})},{key:"isLocked",value:function(e){return!!(!1!==e&&this.items[e]&&this.items[e].metadata&&this.items[e].metadata.locked)}},{key:"addNewItem",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],o=1;"top"===e&&(e=0,o=-1);var a={indent:0,parent:null,order:0};this.items&&this.items.length>0&&this.items[e]&&(a=this.items[e]);var s=new c;if(s.order=a.order+o,s.parent=a.parent,s.indent=a.indent,s.metadata.locked=!1,s.new=!0,n?(s.title="".concat(this.t.copyOf," ").concat(a.title),s.contents=a.contents,s.duplicate=a.id):s.contents="<p></p>",i.push(s),this.items&&this.items.length>0&&this.items[e]&&this.hasChildren(this.items[e].id)&&n){var r={};r[this.items[e].id]=s.id,i=this.recurseCopyChildren(this.items[e].id,r,i)}this.items&&this.items.length>0?i.forEach((function(n,i){return t.items.splice(e+i+1,0,n)})):i.forEach((function(e){return t.items.push(e)}))}},{key:"recurseCopyChildren",value:function(e,t,n){for(var i=this.items.filter((function(t){return t.parent==e})),o=0;o<i.length;o++){var a=i[o],s=new c;s.order=a.order,s.parent=t[a.parent],s.indent=a.indent,s.metadata.locked=!1,s.new=!0,s.title="".concat(this.t.copyOf," ").concat(a.title),s.contents=a.contents,s.collapsed=a.collapsed,s.duplicate=i[o].id,t[i[o].id]=s.id,n.push(s),this.hasChildren(i[o].id)&&this.recurseCopyChildren(i[o].id,t,n)}return n}},{key:"recurseAction",value:function(e,t){for(var n=this,i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],o=this.items.filter((function(t){return t.parent==e})),a=function(e){n.items.map((function(a,s){if(a.id===o[e].id)switch(t){case"delete":n.items[s].delete=i;break;case"lock":n.items[s].metadata.locked=i}})),n.hasChildren(o[e].id)&&n.recurseAction(o[e].id,t,i)},s=0;s<o.length;s++)a(s);return!0}},{key:"itemOp",value:function(e,t){var n=this;if(!1!==e&&this.items[e]&&t){if(this.items[e].metadata.locked)"lock"===t&&(this.items[e].metadata.locked=!1,this.hasChildren(this.items[e].id)&&this.recurseAction(this.items[e].id,t,this.items[e].metadata.locked));else switch(t){case"goto":this.dispatchEvent(new CustomEvent("simple-modal-hide",{bubbles:!0,cancelable:!0,detail:{}}));var i=this.items[e].slug||this.items[e].location;globalThis.location.href=i;case"lock":this.items[e].metadata.locked=!0,this.hasChildren(this.items[e].id)&&this.recurseAction(this.items[e].id,t,this.items[e].metadata.locked);break;case"delete":this.items[e].delete?this.items[e].delete=!1:this.items[e].delete=!0,this.hasChildren(this.items[e].id)&&this.recurseAction(this.items[e].id,t,this.items[e].delete);break;case"add":this.setAttribute("stop-animation","true"),this.addNewItem(e);break;case"duplicate":this.setAttribute("stop-animation","true"),this.addNewItem(e,!0);break;case"in":if(0!==e&&this.items[e].parent!=this.items[e-1].id){var o=this.items[e-1];this.items[e].parent=o.id,this.items[e].order=0,this.items[e].indent=parseInt(o.indent)+1,this.items[e].new||(this.items[e].modified=!0)}break;case"out":if(null!==this.items[e].parent){var a=this.items.find((function(t){return n.items[e].parent===t.id}));this.items[e].parent=a.parent,this.items[e].order=parseInt(a.order)+1,this.items[e].indent=parseInt(a.indent),this.items[e].new||(this.items[e].modified=!0)}break;case"up":case"down":this.setAttribute("stop-animation","true");var s=this.items[e],r=[];this.items.map((function(e){e.parent===s.parent&&r.push(e)})),r.sort((function(e,t){return e.order<t.order?-1:e.order>t.order?1:0}));var d=null;if(r.map((function(e,n){"up"===t&&n>0&&e.id===s.id?d=r[n-1]:"down"===t&&n<r.length-1&&e.id===s.id&&(d=r[n+1])})),d){var l=parseInt(d.order+".0"),c=parseInt(s.order+".0");this.items.map((function(e,t){e.id===d.id?(n.items[t].order=c,n.items[t].new||(n.items[t].modified=!0)):e.id===s.id&&(n.items[t].order=l,n.items[t].new||(n.items[t].modified=!0))}))}}this.__syncUIAndDataModel()}}},{key:"_recurseUpdateIndent",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{id:null},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.items.map((function(i,o){i.parent==t.id&&(e.items[o].indent=n,e._recurseUpdateIndent(e.items[o],n+1))}))}},{key:"_schemaOrderUpdate",value:function(){var e=new u,t=e.itemsToNodes(this.items),n=e.nodesToItems(t),i=[];for(var o in n){var a=this.items.find((function(e){return e.id===n[o].id}));a&&(delete a.children,i.push(a))}this.items=i}}],[{key:"styles",get:function(){return[i(U||(U=o(['\n        :host {\n          display: block;\n          font-family: var(--ddd-font-navigation);\n        }\n        simple-icon-button[hidden] {\n          visibility: hidden !important;\n          opacity: 0;\n          pointer-events: none;\n          padding: 0;\n          margin: 0;\n          height: 0;\n          border: 0;\n        }\n        .controls {\n          position: sticky;\n          top: -32px;\n          background-color: light-dark(white, #262626);\n          z-index: 1;\n          padding: 16px 0 8px 0;\n        }\n        .controls .control {\n          border: 1px solid black;\n          border-radius: 0;\n          padding: 4px;\n        }\n        simple-popover {\n          --simple-popover-max-height: 300px;\n        }\n        simple-popover *:not(.close-btn) {\n          max-width: 40vw;\n        }\n        simple-popover::part(simple-popover-content) {\n          overflow: auto;\n        }\n        .close-btn {\n          z-index: 1000;\n          background-color: white;\n          border: 0px;\n          border-radius: 50%;\n          position: absolute;\n          top: 24px;\n          right: 0;\n        }\n        .container {\n          text-align: left;\n        }\n        ul {\n          list-style: none;\n          padding: 0;\n          margin: 0;\n        }\n        ul li {\n          margin: 0;\n          padding: 0;\n        }\n        .operation {\n          display: inline-flex;\n          --simple-icon-width: 24px;\n          --simple-icon-height: 24px;\n          margin: 0 4px;\n        }\n        .content-adding-operations .operation {\n          display: inline-flex;\n          --simple-icon-width: 24px;\n          --simple-icon-height: 24px;\n          margin: 0 4px;\n          border: 1px solid black;\n          border-radius: 0;\n          padding: 4px;\n        }\n        .lock {\n          margin-right: 16px !important;\n          visibility: var(--outline-designer-lock-visibility);\n        }\n        .del {\n          margin-left: 32px !important;\n        }\n        .goto {\n          margin-left: 32px !important;\n        }\n        .add {\n          margin-left: 16px !important;\n        }\n        li .operations {\n          justify-content: space-evenly;\n          display: flex;\n        }\n        .content-operation {\n          display: inline-flex;\n          opacity: 0;\n          visibility: hidden;\n          --simple-icon-width: 24px;\n          --simple-icon-height: 24px;\n          margin: 0 4px;\n        }\n        .content-operations {\n          justify-content: space-evenly;\n          display: flex;\n        }\n        li.content-child:hover .content-operation {\n          visibility: visible;\n          opacity: 1;\n        }\n        li[class*="collapsed-by-"] {\n          opacity: 0;\n          height: 0px !important;\n          visibility: hidden;\n          padding: 0px !important;\n          margin: 0px !important;\n          width: 0px !important;\n          padding: 0px !important;\n          margin: 0px !important;\n          border: 0px !important;\n          pointer-events: none;\n          z-index: -1;\n        }\n        /* content not rendered if hidden but in case we change that */\n        li[data-contents-collapsed] {\n          opacity: 0;\n          height: 0px !important;\n          visibility: hidden;\n          padding: 0px !important;\n          margin: 0px !important;\n          width: 0px !important;\n          padding: 0px !important;\n          margin: 0px !important;\n          border: 0px !important;\n          pointer-events: none;\n          z-index: -1;\n        }\n        li simple-icon-button:hover {\n          background-color: #f5f5f5;\n        }\n        .active-preview-item {\n          outline: 1px solid grey;\n          outline-offset: -1px;\n        }\n        .label,\n        .label-edit {\n          display: none;\n        }\n        span[disabled].label {\n          pointer-events: none;\n          opacity: 0.6;\n        }\n        .shown {\n          display: inline-block;\n        }\n        .outline-designer-hovered {\n          outline: 2px solid black;\n          outline-offset: -1px;\n          background-color: #e5e5e5;\n        }\n        .make-child-btn {\n          transition: 0.3s all ease-in-out;\n          visibility: hidden;\n          opacity: 0;\n        }\n        .outline-designer-hovered .make-child-btn {\n          visibility: visible;\n          opacity: 0.6;\n        }\n        .outline-designer-hovered .make-child-btn:hover {\n          opacity: 1;\n        }\n        .modified .label::after {\n          content: "*";\n          color: red;\n          font-size: 20px;\n          line-height: 20px;\n        }\n        .new {\n          --simple-icon-width: 16px;\n          --simple-icon-height: 16px;\n          background-color: black;\n          display: block;\n          margin: -14px 0 0 4px;\n        }\n        :host([stop-animation]) .item {\n          transition: none !important;\n        }\n        .item {\n          display: -webkit-box;\n          border: 1px solid;\n          border-color: grey;\n          margin: 0;\n          padding: 4px;\n          cursor: pointer;\n          opacity: 1;\n          visibility: visible;\n          height: 42px;\n          transition:\n            0.3s padding ease-in-out,\n            0.3s border ease-in-out,\n            0.3s margin ease-in-out;\n          overflow: hidden;\n          align-items: center;\n          justify-content: left;\n          display: flex;\n        }\n        .collapse-btn {\n          visibility: hidden;\n        }\n        .item[data-has-children] .collapse-btn {\n          visibility: visible;\n        }\n        .item[data-about-to-delete] {\n          background-color: #ffa5a5;\n          opacity: 0.5;\n          border-color: red;\n        }\n        .item[data-about-to-delete][hidden] {\n          visibility: hidden !important;\n          opacity: 0 !important;\n          padding: 0;\n          margin: 0;\n          height: 0;\n          border: 0;\n        }\n        .item:hover,\n        .item:focus {\n          background-color: #f5f5f5;\n        }\n        .item:hover .label,\n        .item:focus .label {\n          color: black;\n        }\n        ul {\n          list-style: none;\n        }\n        .item .label-edit,\n        .item .label {\n          cursor: text;\n          font-size: 14px;\n          font-weight: bold;\n          min-width: 200px;\n          margin-right: 8px;\n          max-width: 40%;\n          line-height: 1.2;\n          padding: 0 4px;\n          color: light-dark(black, white);\n        }\n\n        .content-child {\n          margin-left: 46px;\n          padding: 8px;\n          height: 24px;\n          border-top: none;\n          border-bottom: none;\n        }\n        .content-heading,\n        .content-non-heading {\n          margin-left: 32px;\n        }\n        .indent-0 {\n          padding-left: 0;\n        }\n        .indent-1 {\n          padding-left: 16px;\n        }\n        .indent-2 {\n          padding-left: calc(16px * 2);\n        }\n        .indent-3 {\n          padding-left: calc(16px * 3);\n        }\n        .indent-4 {\n          padding-left: calc(16px * 4);\n        }\n        .indent-5 {\n          padding-left: calc(16px * 5);\n        }\n        .indent-6 {\n          padding-left: calc(16px * 6);\n        }\n        .indent-7 {\n          padding-left: calc(16px * 7);\n        }\n        .indent-8 {\n          padding-left: calc(16px * 8);\n        }\n        .indent-9 {\n          padding-left: calc(16px * 9);\n        }\n        .indent-10 {\n          padding-left: calc(16px * 10);\n        }\n        .indent-11 {\n          padding-left: calc(16px * 11);\n        }\n        .indent-12 {\n          padding-left: calc(16px * 12);\n        }\n        .indent-13 {\n          padding-left: calc(16px * 13);\n        }\n        .indent-14 {\n          padding-left: calc(16px * 14);\n        }\n        .indent-15 {\n          padding-left: calc(16px * 15);\n        }\n        .indent-16 {\n          padding-left: calc(16px * 16);\n        }\n        .indent-17 {\n          padding-left: calc(16px * 17);\n        }\n        .indent-18 {\n          padding-left: calc(16px * 18);\n        }\n        .indent-19 {\n          padding-left: calc(16px * 19);\n        }\n        .indent-20 {\n          padding-left: calc(16px * 20);\n        }\n      '])))]}},{key:"properties",get:function(){return{haxGizmos:{type:Array},hideDelete:{type:Boolean},activeItemForActions:{type:String},storeTools:{type:Boolean},eventData:{type:Object},items:{type:Array},appReady:{type:Boolean},activePreview:{type:Object},activePreviewIndex:{type:Number},hideContentOps:{type:Boolean,reflect:!0,attribute:"hide-content-ops"},fidelity:{type:String}}}},{key:"tag",get:function(){return"outline-designer"}}]);var g}(m(g)));customElements.define(R.tag,R)}}}));
