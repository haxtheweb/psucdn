System.register(["./2756a297.js","./13e627b4.js","./01ee5819.js"],(function(e,t){"use strict";var a,n,i,o,s,c,l,r,d,m,h,u,p,g,v,f,b,y,I,x,C,T,E,k,S,_,L,w;return{setters:[function(e){a=e._,n=e.a,i=e.i,o=e.b,s=e.e,c=e.f,l=e.g,r=e.x,d=e.K,m=e.N,h=e.a0,u=e.aL,p=e.o,g=e.t,v=e.a7,f=e.aM,b=e.aN,y=e.v,I=e.V,x=e.s,C=e.c,T=e.d,E=e.q,k=e.aD,S=e.a3,_=e.aH,L=e.j,w=e.k},function(){},function(){}],execute:function(){var N,j,A={url:new URL("./elements/haxcms-elements/lib/core/haxcms-site-builder.js",document.baseURI).href};function M(e){e.matches?m.darkMode=!0:m.darkMode=!1}var D=e("HAXCMSSiteBuilder",function(e){function I(){var e;for(var t in C(this,I),(e=T(this,I)).windowControllers=new AbortController,e.t=s(s({},c(l(I.prototype),"t",e)),{},{pageNotFound:"Page not found",navigateToAnotherPageInTheMenu:"Navigate to another page in the menu",couldNotBeLocated:"could not be located",hereAreSomePossibleRemedies:"Here are some possible remedies:",useSearchToLocateTheContentYouAreLookingFor:"Use Search to locate the content you are looking for",goToTheHomePage:"Go to the home page"}),e.registerLocalization({context:e,namespace:"haxcms",localesPath:new URL("../../locales/haxcms.es.json",A.url).href.replace("/haxcms.es.json","/"),locales:["es"]}),e._timeStamp=Math.floor(Date.now()/1e3),e.disableFeatures="",e.isLoggedIn=!1,e.__disposer=[],e.queryParams={},e.loading=!1,e.__imported={},e.themeLoaded=!1,e.outlineLocation="",e.activeItemLocation="",u.storePieces.siteBuilder=e,e.children)if(e.children[t].tagName&&e.children[t].getAttribute("slot")){var a=e.children[t].cloneNode(!0),n=a.getAttribute("slot");switch(n){case"haxcms-site-editor-ui-prefix-avatar":case"haxcms-site-editor-ui-prefix-buttons":case"haxcms-site-editor-ui-suffix-buttons":case"haxcms-site-editor-ui-main-menu":case"haxcms-site-editor-ui-topbar-character-button":m.setupSlots[n].push(a)}}return globalThis.addEventListener("hax-store-ready",e.storeReady.bind(e),{signal:e.windowControllers.signal}),globalThis.addEventListener("haxcms-trigger-update",e._triggerUpdatedData.bind(e),{signal:e.windowControllers.signal}),globalThis.addEventListener("haxcms-trigger-update-node",e._triggerUpdatedNode.bind(e),{signal:e.windowControllers.signal}),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",M,{signal:e.windowControllers.signal}),p((function(){E("app-hax-darkMode",g(m.darkMode)),g(m.darkMode)?globalThis.document.body.classList.add("dark-mode"):globalThis.document.body.classList.remove("dark-mode")})),p((function(){e.isLoggedIn=g(m.isLoggedIn),k.writeMemory("isLoggedIn",e.isLoggedIn);var t=Math.floor(Date.now()/1e3);if(e.isLoggedIn&&!e.loggedInTime){e.loggedInTime=t,e._timeStamp=e.loggedInTime;var a=k.readMemory("recentLogins");a?a&&(a.length<5&&a.shift(),a.push(t),k.writeMemory("recentLogins",a,"long")):k.writeMemory("recentLogins",[t],"long")}})),p((function(){var e=g(k.memory),t=g(k.action);!1===e.editMode&&e.interactionDelay>=3600&&null===t.type&&m.cmsSiteEditor.haxCmsSiteEditorUIElement&&m.cmsSiteEditor.haxCmsSiteEditorUIElement.shadowRoot&&setTimeout((function(){m.cmsSiteEditor.haxCmsSiteEditorUIElement.shadowRoot.querySelector("#editbutton").dataPulse="1"}),300),k.active&&k.memory.isLoggedIn&&k.memory.recentTarget===S&&null===S.programName&&k.memory.interactionDelay>600&&["paste","key"].includes(t.type)?_(S.value)&&S.waveWand([S.value,"/",{},"hax-agent","Agent"],null,"coin2"):k.active&&k.memory.isLoggedIn&&null===S.programName&&["paste"].includes(t.type)&&"url"==k.data.architype&&S.waveWand([g(k.data.value),"/",{},"hax-agent","Agent"],null,"coin2")})),e}return a(I,e),n(I,[{key:"render",value:function(){return r(N||(N=o(['\n      <site-ai-chat></site-ai-chat>\n      <haxcms-site-router base-uri="','"></haxcms-site-router>\n      <simple-progress .disabled="','"></simple-progress>\n      <div id="slot"><slot></slot></div>\n      <slot name="haxcms-site-editor-ui-prefix-avatar"></slot>\n      <slot name="haxcms-site-editor-ui-prefix-buttons"></slot>\n      <slot name="haxcms-site-editor-ui-suffix-buttons"></slot>\n      <slot name="haxcms-site-editor-ui-main-menu"></slot>\n      <slot name="haxcms-site-editor-ui-topbar-character-button"></slot>\n      <simple-colors-polymer></simple-colors-polymer>\n    '])),this.baseURI,!this.loading)}},{key:"_updateManifest",value:function(e){this.manifest=s({},e)}},{key:"_updateLoading",value:function(e){this.loading=e.detail.value}},{key:"hashCode",value:function(e){return e.split("").reduce((function(e,t){return 0|(e=(e<<5)-e+t.charCodeAt(0))}),0)}},{key:"nodeNormalizeIDs",value:function(e){if(e.tagName&&null==e.getAttribute("id")&&["H1","H2","H3","H4","H5","H6"].includes(e.tagName))if(e.getAttribute("resource"))e.setAttribute("id",e.getAttribute("resource"));else{var t=e.tagName.toLowerCase()+"-"+this.hashCode(e.innerText);e.setAttribute("id",t)}}},{key:"_updateActiveItemContent",value:function(e){var t=this;if(e){var a=globalThis.document.createElement("div");a.innerHTML=e;var n,i=d(a.childNodes);try{for(i.s();!(n=i.n()).done;){var o=n.value;this.nodeNormalizeIDs(o)}}catch(e){i.e(e)}finally{i.f()}e=a.innerHTML,this.activeItemContent="",setTimeout((function(){t.activeItemContent=e}),0)}else m.cmsSiteEditorBackend.instance&&m.cmsSiteEditorBackend.instance.updateActiveItemContent?m.cmsSiteEditorBackend.instance.updateActiveItemContent():this.activeItemContent=""}},{key:"display404Error",value:function(){var e=this;if(m.themeElement){var t=globalThis.document.createDocumentFragment(),a=globalThis.document.createElement("p");a.innerHTML="<strong>".concat(m.getInternalRoute(),"</strong> ").concat(this.t.couldNotBeLocated,". ").concat(this.t.hereAreSomePossibleRemedies,'\n      <ul>\n        <li><a href="x/search?search=').concat(m.getInternalRoute(),'">').concat(this.t.useSearchToLocateTheContentYouAreLookingFor,'</a></li>\n        <li><a href="./">').concat(this.t.goToTheHomePage,"</a></li>\n        <li>").concat(this.t.navigateToAnotherPageInTheMenu,"</li>\n      </ul>"),t.appendChild(a),h(m.themeElement,"*"),m.themeElement.appendChild(t),setTimeout((function(){m.toast(e.t.pageNotFound,4e3,{fire:!0,walking:!0})}),1e3)}}},{key:"renderInternalRoute",value:function(){if(m.themeElement){var e=globalThis.document.createDocumentFragment();m.activeItem.component&&t.import("../ui-components/routes/".concat(m.activeItem.component,".js")).then((function(){var t=globalThis.document.createElement(m.activeItem.component);e.appendChild(t),h(m.themeElement,"*"),m.themeElement.appendChild(e)}))}}},{key:"loadPageData",value:(D=L(w().mark((function e(){var t,a=this;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.activeItemLocation||this.loading){e.next=11;break}if(this.loading=!0,t="".concat(this.outlineLocation).concat(this.activeItemLocation),this._timeStamp&&(-1!=t.indexOf("?")?t+="&".concat(this._timeStamp):t+="?".concat(this._timeStamp)),"hax-internal-route.html"!==this.activeItemLocation){e.next=9;break}this.renderInternalRoute(),this.loading=!1,e.next=11;break;case 9:return e.next=11,fetch(t).then((function(e){if(e.ok)return e.text();a.display404Error()})).then((function(e){a._updateActiveItemContent(e),a.loading=!1})).catch((function(e){a.lastErrorChanged(e)}));case 11:case"end":return e.stop()}}),e,this)}))),function(){return D.apply(this,arguments)})},{key:"loadJOSData",value:(x=L(w().mark((function e(){var t,a,n,i=this;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.file){e.next=15;break}this.loading=!0,t="".concat(this.outlineLocation).concat(this.file),e.prev=3,a=JSON.parse(this.file),this._updateManifest(a),this.loading=!1,e.next=15;break;case 9:return e.prev=9,e.t0=e.catch(3),this._timeStamp&&""!=this._timeStamp&&(-1!=t.indexOf("?")?t+="&".concat(this._timeStamp):t+="?".concat(this._timeStamp)),n={cache:"no-cache"},e.next=15,fetch(t,n).then((function(e){if(e.ok)return e.json()})).then((function(e){i._updateManifest(e),i.loading=!1})).catch((function(e){i.lastErrorChanged(e)}));case 15:case"end":return e.stop()}}),e,this,[[3,9]])}))),function(){return x.apply(this,arguments)})},{key:"updated",value:function(e){var t=this;c(l(I.prototype),"updated",this)&&c(l(I.prototype),"updated",this).call(this,e);var a=!1,n=!1;e.forEach((function(e,i){["outlineLocation","activeItemLocation"].includes(i)&&""!=t[i]&&(n=!0),["outlineLocation","file"].includes(i)&&""!=t[i]&&(a=!0),"_timeStamp"==i&&t[i]&&(a=!0,n=!0),"themeData"==i?t._themeChanged(t[i],e):"themeName"==i?t._themeNameChanged(t[i],e):"outlineLocation"==i?t.dispatchEvent(new CustomEvent("outline-location-changed",{bubbles:!0,cancelable:!0,composed:!0,detail:t[i]})):"manifest"==i?(t.dispatchEvent(new CustomEvent("manifest-changed",{bubbles:!0,cancelable:!0,composed:!0,detail:t[i]})),t._manifestChanged(t[i],e)):"activeItem"==i?(t.dispatchEvent(new CustomEvent("active-item-changed",{bubbles:!0,cancelable:!0,composed:!0,detail:t[i]})),t._activeItemChanged(t[i],e)):"activeItemContent"==i&&(t.dispatchEvent(new CustomEvent("active-item-content-changed",{bubbles:!0,detail:t[i]})),t._activeItemContentChanged(t[i],e))})),a&&this.__ready&&this.loadJOSData(),n&&this.__ready&&this.loadPageData()}},{key:"_themeNameChanged",value:function(e){e&&(m.themeElement&&m.themeElement.remove(),h(this,"*"),m.themeElement=globalThis.document.createElement(e),m.themeElement.classList.add("haxcms-theme-element"),this.appendChild(m.themeElement))}},{key:"lastErrorChanged",value:function(e){e&&(console.error(e),e.detail&&e.detail.value?(window&&globalThis.location&&globalThis.appSettings&&globalThis.appSettings.reloadOnError&&globalThis.location.reload(),m.toast(e.detail.value.status+" "+e.detail.value.statusText,5e3,{fire:!0})):window&&globalThis.location&&globalThis.appSettings&&globalThis.appSettings.reloadOnError&&globalThis.location.reload())}},{key:"firstUpdated",value:function(e){var a=this;c(l(I.prototype),"firstUpdated",this)&&c(l(I.prototype),"firstUpdated",this).call(this,e),this.__ready=!0,m.appReady=!0,globalThis.dispatchEvent(new CustomEvent("haxcms-ready",{bubbles:!0,composed:!0,cancelable:!1,detail:this})),t.import("./7b126ff1.js").then((function(e){t.import("./8b84c5e6.js"),a.editorBuilder=globalThis.document.createElement("haxcms-editor-builder"),a.parentNode?a.parentNode.insertBefore(a.editorBuilder,a):globalThis.document.body.appendChild(a.editorBuilder),"published"!==u.getApplicationContext()?a._timeStamp=Math.floor(Date.now()/1e3):a._timeStamp=""})).catch((function(e){console.warn(e)})),globalThis.dispatchEvent(new Event("resize")),setTimeout((function(){p((function(e){if(a.themeData=g(m.themeData),a.themeData){var t=new URLSearchParams(globalThis.location.search),n=t.get("format");if(null!=n&&"print-page"===n)a.themeData.element="haxcms-print-theme";var i=t.get("disable-features");null!=i&&(a.disableFeatures=i)}a.themeData&&a.themeData.element!==a.themeName&&(a.themeName=a.themeData.element),a.__disposer.push(e)})),p((function(e){var t=g(m.activeItem);t&&t.location&&(a.activeItemLocation=t.location),a.__disposer.push(e)}))}),0)}},{key:"disconnectedCallback",value:function(){for(var e in this.__disposer)this.__disposer[e].dispose();this.windowControllers.abort(),c(l(I.prototype),"disconnectedCallback",this).call(this)}},{key:"storeReady",value:function(e){m.cmsSiteEditor&&m.cmsSiteEditor.instance&&globalThis.HaxStore.requestAvailability().activeHaxBody&&m.activeItemContent&&globalThis.HaxStore.requestAvailability().activeHaxBody.importContent(m.activeItemContent)}},{key:"replaceTagReplacement",value:function(e){for(var t=/\<(\w+?\-\w*.*)\s*?\>/gim,a=t.exec(e);null!=a;){var n=a[1].replace("<","").replace(">","");n.indexOf(" ")&&(n=n.split(" ")[0]),-1!=n.indexOf("-")&&(e=(e=e.replace("<"+n,'<replace-tag with="'+n+'" ')).replace("</"+n+">","</replace-tag>")),a=t.exec(e)}return e}},{key:"_activeItemContentChanged",value:function(e,a){var n=this;if(e){var i=e;null!==i&&m.activeItem&&m.activeItem.metadata&&(h(m.themeElement,"*"),e='<page-break\n        break-type="site"\n        title="'.concat(m.activeItem.title,'"\n        parent="').concat(m.activeItem.parent,'"\n        item-id="').concat(m.activeItem.id,'"\n        slug="').concat(m.activeItem.slug,'"\n        description="').concat(m.activeItem.description,'"\n        order="').concat(m.activeItem.order,'"\n        ').concat(m.activeItem.metadata.pageType?'page-type="'.concat(m.activeItem.metadata.pageType,'"'):"","\n        ").concat(m.activeItem.metadata.tags?'tags="'.concat(m.activeItem.metadata.tags,'"'):"","\n        ").concat(m.activeItem.metadata.hideInMenu?'hide-in-menu="hide-in-menu"':"","\n        ").concat(m.activeItem.metadata.relatedItems?'related-items="'.concat(m.activeItem.metadata.relatedItems,'"'):"","\n        ").concat(m.activeItem.metadata.image?'image="'.concat(m.activeItem.metadata.image,'"'):"","\n        ").concat(m.activeItem.metadata.icon?'icon="'.concat(m.activeItem.metadata.icon,'"'):"","\n        ").concat(m.activeItem.metadata.accentColor?'accent-color="'.concat(m.activeItem.metadata.accentColor,'"'):"","\n        ").concat(m.activeItem.metadata.theme&&m.activeItem.metadata.theme.key?'developer-theme="'.concat(m.activeItem.metadata.theme.key,'"'):"","\n        ").concat(m.activeItem.metadata.locked?'locked="locked"':"","\n        ").concat(!1===m.activeItem.metadata.published?"":'published="published"'," ></page-break>").concat(e),i=v(e),m.activeItemContent=i,setTimeout((function(){if(0===m.themeElement.childNodes.length){var e=document.createRange().createContextualFragment(n.replaceTagReplacement(i));m.themeElement.appendChild(e),n.dispatchEvent(new CustomEvent("json-outline-schema-active-body-changed",{bubbles:!0,composed:!0,cancelable:!1,detail:i}))}if(!globalThis.WCAutoload&&f(n.manifest,"metadata.node.dynamicElementLoader")){var a=b(i),o=new URL("./locales/haxcms.es.json",A.url).href+"/../";for(var s in a){var c=a[s];n.manifest.metadata.node.dynamicElementLoader[c]&&!globalThis.customElements.get(c)&&t.import("".concat(o,"../../../../").concat(n.manifest.metadata.node.dynamicElementLoader[c])).then((function(e){})).catch((function(e){console.warn(e)}))}}else globalThis.WCAutoload&&setTimeout((function(){globalThis.WCAutoload.process()}),0)}),5))}}},{key:"_activeItemChanged",value:function(e,t){this.shadowRoot&&e&&"undefined"!==y(e.id)?this.queryParams.nodeId=e.id:t&&!e&&this.dispatchEvent(new CustomEvent("json-outline-schema-active-body-changed",{bubbles:!0,composed:!0,cancelable:!1,detail:null}))}},{key:"_triggerUpdatedData",value:function(e){this.isLoggedIn?this._timeStamp=Math.floor(Date.now()/1e3):this._timeStamp=""}},{key:"_triggerUpdatedNode",value:function(e){this.loadPageData()}},{key:"_manifestChanged",value:function(e,t){e&&e.metadata&&e.items&&m.loadManifest(e,this)}},{key:"_themeChanged",value:function(e,a){var n=this;if(e){this.themeLoaded=!1;var i=e;if("undefined"!==y(this.__imported[i.element]))this.themeLoaded=!0;else if(globalThis.WCAutoload)this.__imported[i.element]=i.element,this.themeLoaded=!0,setTimeout((function(){globalThis.WCAutoload.process(),globalThis.dispatchEvent(new CustomEvent("haxcms-theme-ready",{bubbles:!0,composed:!0,cancelable:!1,detail:n}))}),5);else try{t.import(new URL("./../../../../../"+e.path,A.url).href).then((function(e){n.__imported[i.element]=i.element,n.themeLoaded=!0}))}catch(e){this.themeLoaded=!0}}}}],[{key:"styles",get:function(){return[i(j||(j=o(["\n        :host {\n          display: block;\n          position: relative;\n        }\n        :host([is-logged-in]) {\n          max-height: calc(100vh - 48px);\n        }\n        :host #slot {\n          opacity: 0.2;\n          visibility: hidden;\n        }\n        :host([theme-loaded]) #slot {\n          opacity: 1;\n          visibility: visible;\n        }\n        simple-progress {\n          display: block;\n          width: 100%;\n          position: fixed;\n          top: 0;\n          left: 0;\n          right: 0;\n          background-color: transparent;\n          z-index: 1000;\n          --simple-progress-active-color: var(\n            --haxcms-color,\n            rgba(255, 255, 255, 0.5)\n          );\n        }\n        simple-progress[disabled] {\n          display: none;\n        }\n      "])))]}},{key:"tag",get:function(){return"haxcms-site-builder"}},{key:"properties",get:function(){return s(s({},c(l(I),"properties",this)),{},{activeItemLocation:{type:String,attribute:"active-item-location"},disableFeatures:{type:String,reflect:!0,attribute:"disable-features"},_timeStamp:{type:String},isLoggedIn:{type:Boolean,reflect:!0,attribute:"is-logged-in"},queryParams:{type:Object},loading:{type:Boolean,reflect:!0},outlineLocation:{type:String,attribute:"outline-location"},manifest:{type:Object},themeData:{type:Object},themeName:{type:String},__imported:{type:Object},themeLoaded:{type:Boolean,reflect:!0,attribute:"theme-loaded"},activeItemContent:{type:String},file:{type:String},baseURI:{type:String,attribute:"base-uri"}})}}]);var x,D}(I(x)));globalThis.HAXme=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;null==e&&(e="demo",globalThis.appSettings={login:"dist/dev/login.json",logout:"dist/dev/logout.json",saveNodePath:"dist/dev/saveNode.json",saveManifestPath:"dist/dev/saveManifestPath.json",createNodePath:"dist/dev/saveNode.json",deleteNodePath:"dist/dev/saveNode.json",saveOutlinePath:"dist/dev/saveNode.json",publishSitePath:"dist/dev/saveNode.json",syncSitePath:"dist/dev/saveNode.json",getSiteFieldsPath:"dist/dev/getSiteFieldsPath.json",revertSitePath:"dist/dev/saveNode.json",getFormToken:"adskjadshjudfu823u823u8fu8fij",appStore:{url:"dist/dev/appstore.json"},jwt:"made-up-thing",themes:{"haxcms-dev-theme":{element:"haxcms-dev-theme",path:"@haxtheweb/haxcms-elements/lib/haxcms-dev-theme.js",name:"Developer theme"}}}),"demo"==e&&(globalThis.HAXCMSContext="demo"),globalThis.document.body&&(globalThis.document.body.querySelector("haxcms-editor-builder").__appliedContext=!1,globalThis.document.body.querySelector("haxcms-editor-builder").applyContext(e))},customElements.define(D.tag,D)}}}));
